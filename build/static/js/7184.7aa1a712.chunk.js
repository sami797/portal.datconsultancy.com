"use strict";
(self["webpackChunkdat_projects"] = self["webpackChunkdat_projects"] || []).push([[7184],{

/***/ 44394:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   d: () => (/* binding */ Switch)
/* harmony export */ });
/* harmony import */ var C_Users_Developer_datportal_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(89379);
/* harmony import */ var C_Users_Developer_datportal_node_modules_babel_runtime_helpers_esm_objectWithoutProperties_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(80045);
/* harmony import */ var antd__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(92759);
/* harmony import */ var antd__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(25933);
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(9950);
/* harmony import */ var _helpers__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(38266);
/* harmony import */ var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(44414);
const _excluded=["onChange","checked","recordId","allowChange"];const Switch=_ref=>{let{onChange,checked,recordId,allowChange=true}=_ref,rest=(0,C_Users_Developer_datportal_node_modules_babel_runtime_helpers_esm_objectWithoutProperties_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"] */ .A)(_ref,_excluded);const[buttonState,setButtonState]=(0,react__WEBPACK_IMPORTED_MODULE_0__.useState)({loading:false,checked:false});const onSwitchChange=checked=>{if(allowChange===true){setButtonState((0,C_Users_Developer_datportal_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"] */ .A)((0,C_Users_Developer_datportal_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"] */ .A)({},buttonState),{},{loading:true}));onChange(checked,recordId,rest).then(res=>{setButtonState((0,C_Users_Developer_datportal_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"] */ .A)((0,C_Users_Developer_datportal_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"] */ .A)({},buttonState),{},{checked:checked,loading:false}));antd__WEBPACK_IMPORTED_MODULE_4__/* ["default"] */ .Ay.success(res.data.message);}).catch(err=>{setButtonState((0,C_Users_Developer_datportal_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"] */ .A)((0,C_Users_Developer_datportal_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"] */ .A)({},buttonState),{},{loading:false}));let serverErrors=(0,_helpers__WEBPACK_IMPORTED_MODULE_5__/* .errorHandler */ .r)(err);if(typeof serverErrors.message==="string"){antd__WEBPACK_IMPORTED_MODULE_4__/* ["default"] */ .Ay.error(serverErrors.message);}else{antd__WEBPACK_IMPORTED_MODULE_4__/* ["default"] */ .Ay.error("Something went wrong");}});}else{antd__WEBPACK_IMPORTED_MODULE_4__/* ["default"] */ .Ay.error("You don't have permission to change this record, please contact your admin.");}};(0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(()=>{setButtonState((0,C_Users_Developer_datportal_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"] */ .A)((0,C_Users_Developer_datportal_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"] */ .A)({},buttonState),{},{checked:checked}));},[checked]);return/*#__PURE__*/(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(antd__WEBPACK_IMPORTED_MODULE_6__/* ["default"] */ .A,{checked:buttonState.checked,onChange:onSwitchChange,loading:buttonState.loading});};

/***/ }),

/***/ 97184:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__);

// EXPORTS
__webpack_require__.d(__webpack_exports__, {
  "default": () => (/* binding */ Promotion)
});

// EXTERNAL MODULE: ./node_modules/@babel/runtime/helpers/esm/objectSpread2.js
var objectSpread2 = __webpack_require__(89379);
// EXTERNAL MODULE: ./node_modules/react/index.js
var react = __webpack_require__(9950);
// EXTERNAL MODULE: ./src/Components/Templates/SiteSettings/index.tsx
var SiteSettings = __webpack_require__(16181);
// EXTERNAL MODULE: ./node_modules/antd/es/date-picker/index.js + 56 modules
var date_picker = __webpack_require__(4132);
// EXTERNAL MODULE: ./node_modules/antd/es/form/index.js + 18 modules
var es_form = __webpack_require__(10678);
// EXTERNAL MODULE: ./node_modules/antd/es/message/index.js + 1 modules
var message = __webpack_require__(92759);
// EXTERNAL MODULE: ./src/Components/Atoms/index.tsx + 12 modules
var Atoms = __webpack_require__(9394);
// EXTERNAL MODULE: ./src/Components/Organisms/SiteSettings/Common/styles.module.scss
var styles_module = __webpack_require__(41394);
// EXTERNAL MODULE: ./src/Components/Organisms/Skeletons/index.tsx
var Skeletons = __webpack_require__(70619);
// EXTERNAL MODULE: ./src/helpers/constants.ts
var constants = __webpack_require__(65944);
// EXTERNAL MODULE: ./src/Components/Atoms/ServerErrorHandler/index.tsx
var ServerErrorHandler = __webpack_require__(13321);
// EXTERNAL MODULE: ./src/helpers/error-handler.ts
var error_handler = __webpack_require__(38266);
// EXTERNAL MODULE: ./src/Modules/Country/index.ts
var Country = __webpack_require__(83584);
// EXTERNAL MODULE: ./src/services/axiosInstance.ts
var axiosInstance = __webpack_require__(83365);
// EXTERNAL MODULE: ./src/Modules/Common/config.ts
var config = __webpack_require__(21073);
;// ./src/Modules/Promotion/index.ts
class PromotionModule{constructor(){this.endPoint="promotion";this.getAllRecords=queryData=>{return axiosInstance/* default */.A.get(this.endPoint,{params:queryData});};this.getRecordById=id=>{return axiosInstance/* default */.A.get("".concat(this.endPoint,"/").concat(id,"?all=true"));};this.deleteRecord=id=>{return axiosInstance/* default */.A.delete("".concat(this.endPoint,"/").concat(id));};this.createRecord=data=>{return axiosInstance/* default */.A.post(this.endPoint+"/",data,{headers:config/* FormDataHeader */.Y});};this.updateRecord=(data,id)=>{return axiosInstance/* default */.A.patch("".concat(this.endPoint,"/").concat(id),data,{headers:config/* FormDataHeader */.Y});};}}
// EXTERNAL MODULE: ./node_modules/moment/moment.js
var moment = __webpack_require__(59051);
var moment_default = /*#__PURE__*/__webpack_require__.n(moment);
;// ./src/Modules/Package/index.ts
class PackageModule{constructor(){this.endPoint="package";this.createRecord=data=>{return axiosInstance/* default */.A.post(this.endPoint+"/",data);};this.getAllRecords=()=>{return axiosInstance/* default */.A.get(this.endPoint);};this.getAllPublished=()=>{return axiosInstance/* default */.A.get(this.endPoint+"/findPublished");};this.getRecordById=id=>{return axiosInstance/* default */.A.get("".concat(this.endPoint,"/").concat(id));};this.updateRecord=(data,id)=>{return axiosInstance/* default */.A.patch("".concat(this.endPoint,"/").concat(id),data);};this.deleteRecord=id=>{return axiosInstance/* default */.A.delete("".concat(this.endPoint,"/").concat(id));};// validate package by coupon code and credit package id
this.validatePackage=data=>{return axiosInstance/* default */.A.post("".concat(this.endPoint,"/validate-coupon-code"),data);};}}class PackagePromotion{constructor(){this.endPoint="package-promotions";this.createRecord=data=>{return axiosInstance/* default */.A.post(this.endPoint+"/",data);};this.getAllRecords=()=>{return axiosInstance/* default */.A.get(this.endPoint);};this.getRecordById=promotionId=>{return axiosInstance/* default */.A.get("".concat(this.endPoint,"/").concat(promotionId));};this.deleteMultipleRecords=(promotionId,packageIds)=>{return axiosInstance/* default */.A.delete("".concat(this.endPoint,"/removeMultiple/").concat(promotionId),{params:{packageIds}});};this.deleteRecordById=(promotionId,packageId)=>{return axiosInstance/* default */.A.delete("".concat(this.endPoint,"/").concat(promotionId,"/").concat(packageId));};this.updateRecord=data=>{return axiosInstance/* default */.A.patch(this.endPoint+"/",data);};}}
// EXTERNAL MODULE: ./src/Modules/CreditsPackage/index.ts
var CreditsPackage = __webpack_require__(86560);
// EXTERNAL MODULE: ./src/helpers/common.ts
var common = __webpack_require__(88132);
// EXTERNAL MODULE: ./node_modules/react/jsx-runtime.js
var jsx_runtime = __webpack_require__(44414);
;// ./src/Components/Organisms/SiteSettings/Promotion/modal.tsx
// import { PromotionDiscountType } from "../../../../helpers/commonEnums";
const{RangePicker}=date_picker/* default */.A;const SitePromotionModal=props=>{var _Object$entries,_recordData$data,_recordData$data2,_recordData$data3,_recordData$data4,_recordData$data5,_recordData$data6;const{openModal,onCancel,type,record,reloadTableData,permissions:{createPromotion,updatePromotion}}=props;const[form]=es_form/* default */.A.useForm();const module=(0,react.useMemo)(()=>new PromotionModule(),[]);const countryModule=(0,react.useMemo)(()=>new Country/* CountryModule */.j(),[]);const packageModule=(0,react.useMemo)(()=>new PackageModule(),[]);const creditPackageModule=(0,react.useMemo)(()=>new CreditsPackage/* CreditsPackageModule */.l(),[]);const[recordData,setRecordData]=(0,react.useState)();const[countries,setCountries]=(0,react.useState)([]);const[packages,setPackages]=(0,react.useState)([]);const[creditPackages,setCreditPackages]=(0,react.useState)([]);const[date,setDate]=(0,react.useState)({validFrom:"",validTo:""});const handleErrors=err=>{const error=(0,error_handler/* errorHandler */.r)(err);if(typeof error.message=="string"){setRecordData((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},recordData),{},{error:error.message}));}else{let errData=(0,ServerErrorHandler/* HandleServerErrors */.p)(error.message,[]);form.setFields(errData);setRecordData((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},recordData),{},{error:""}));}};const handleAlertClose=()=>{setRecordData((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},recordData),{},{error:""}));};const getDataBySlug=(0,react.useCallback)(()=>{module.getRecordById(record).then(res=>{if(res.data&&res.data.data){var _res$data,_res$data$data,_res$data2,_res$data2$data,_res$data3,_res$data3$data,_res$data4,_res$data4$data,_res$data5,_res$data5$data,_res$data5$data$packa,_res$data6,_res$data6$data,_res$data6$data$credi;form.setFieldsValue((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},res.data.data),{},{translations:(_res$data=res.data)===null||_res$data===void 0?void 0:(_res$data$data=_res$data.data)===null||_res$data$data===void 0?void 0:_res$data$data.localization,isPublished:(_res$data2=res.data)===null||_res$data2===void 0?void 0:(_res$data2$data=_res$data2.data)===null||_res$data2$data===void 0?void 0:_res$data2$data.isPublished,date:[moment_default()((_res$data3=res.data)===null||_res$data3===void 0?void 0:(_res$data3$data=_res$data3.data)===null||_res$data3$data===void 0?void 0:_res$data3$data.validFrom),moment_default()((_res$data4=res.data)===null||_res$data4===void 0?void 0:(_res$data4$data=_res$data4.data)===null||_res$data4$data===void 0?void 0:_res$data4$data.validTo)],packagesId:(_res$data5=res.data)===null||_res$data5===void 0?void 0:(_res$data5$data=_res$data5.data)===null||_res$data5$data===void 0?void 0:(_res$data5$data$packa=_res$data5$data.packagePromotions)===null||_res$data5$data$packa===void 0?void 0:_res$data5$data$packa.map(item=>item.packageId),creditPackagesId:(_res$data6=res.data)===null||_res$data6===void 0?void 0:(_res$data6$data=_res$data6.data)===null||_res$data6$data===void 0?void 0:(_res$data6$data$credi=_res$data6$data.creditPackagePromotions)===null||_res$data6$data$credi===void 0?void 0:_res$data6$data$credi.map(item=>item.creditPackageId)}));setRecordData((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},res.data),{},{loading:false}));}}).catch(err=>{handleErrors(err);});},[form,record,module]);const getCountryList=(0,react.useCallback)(()=>{countryModule.getAllRecords().then(res=>{if(res.data&&res.data.data){setCountries(res.data.data);}});},[countryModule]);const getPackages=(0,react.useCallback)(()=>{packageModule.getAllRecords().then(res=>{if(res.data&&res.data.data){setPackages(res.data.data);}});},[packageModule]);const getCreditPackages=(0,react.useCallback)(()=>{creditPackageModule.getAllPublished().then(res=>{if(res.data&&res.data.data){setCreditPackages(res.data.data);}});},[creditPackageModule]);(0,react.useEffect)(()=>{if(type==="edit"){setRecordData({loading:true});// fetch data by slug or id
getDataBySlug();// fetch the countries
getCountryList();// fetch the packages
getPackages();// fetch the credit packages
getCreditPackages();}else{// fetch the countries
getCountryList();// fetch the packages
getPackages();// fetch the credit packages
getCreditPackages();form.resetFields();}},[openModal,type,form,getDataBySlug,getCountryList,getCreditPackages,getPackages]);const onFinish=formValues=>{setRecordData((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},recordData),{},{buttonLoading:true}));const formData=new FormData();const excludeFields=["image","translations","packagesId","creditPackagesId"];Object.entries(formValues).forEach(ele=>{if(!excludeFields.includes(ele[0])){formData.append(ele[0],ele[1]);}});// remove the date field from the form data and add the validFrom and validTo fields
if(formValues.date){formData.delete("date");if(date.validFrom||date.validTo){formData.append("validFrom",date===null||date===void 0?void 0:date.validFrom);formData.append("validTo",date===null||date===void 0?void 0:date.validTo);}}// credit packages is an array of ids
if(formValues.creditPackagesId){formValues.creditPackagesId.forEach((item,index)=>{formData.append("creditPackagesId[".concat(index,"]"),item.toString());});}// packages is an array of ids
if(formValues.packagesId){formValues.packagesId.forEach((item,index)=>{formData.append("packagesId[".concat(index,"]"),item.toString());});}if(formValues["image"]&&typeof formValues["image"]!=="string"&&formValues["image"]["fileList"].length>0){formData.append("image",formValues["image"]["fileList"][0]["originFileObj"]);}if(formValues.translations){formValues.translations.forEach((item,index)=>{formData.append("translations[".concat(index+1,"][language]"),item.language);formData.append("translations[".concat(index+1,"][title]"),item.title);formData.append("translations[".concat(index+1,"][description]"),item.description);});}switch(type){case"edit":{if(updatePromotion){module.updateRecord(formData,recordData===null||recordData===void 0?void 0:recordData.data.id).then(res=>{reloadTableData();onCancel();setRecordData(prev=>(0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},prev),{},{loading:false,buttonLoading:false}));}).catch(err=>{handleErrors(err);setRecordData(prev=>(0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},prev),{},{loading:false,buttonLoading:false}));});}else{setRecordData(prev=>(0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},prev),{},{buttonLoading:false}));message/* default */.Ay.error("You don't have permission to update this record");}break;}case"new":{if(createPromotion===true){module.createRecord(formData).then(res=>{reloadTableData();onCancel();setRecordData(prev=>(0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},prev),{},{buttonLoading:false}));}).catch(err=>{handleErrors(err);setRecordData(prev=>(0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},prev),{},{buttonLoading:false}));});}else{setRecordData(prev=>(0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},prev),{},{buttonLoading:false}));message/* default */.Ay.error("You don't have permission to create this record");}break;}}};return/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* CustomModal */.jo,{visible:openModal,closable:true,onCancel:onCancel,titleText:type==="edit"?"Edit Promotion":"Add New Promotion",showFooter:false,children:recordData!==null&&recordData!==void 0&&recordData.loading?/*#__PURE__*/(0,jsx_runtime.jsx)(Skeletons/* default */.A,{items:10}):/*#__PURE__*/(0,jsx_runtime.jsxs)(es_form/* default */.A,{className:styles_module/* default */.A.form,onFinish:onFinish,form:form,children:[(recordData===null||recordData===void 0?void 0:recordData.error)&&/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* CustomErrorAlert */.WZ,{description:recordData===null||recordData===void 0?void 0:recordData.error,isClosable:true,onClose:handleAlertClose}),/*#__PURE__*/(0,jsx_runtime.jsxs)("div",{children:[/*#__PURE__*/(0,jsx_runtime.jsx)(es_form/* default */.A.Item,{name:"discountType",rules:[{required:true,message:"Please Select a discount type"}],children:/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* CustomSelect */.Ae,{label:"Discount Type",asterisk:true,placeholder:"Please Select a discount type",options:(_Object$entries=Object.entries([]))===null||_Object$entries===void 0?void 0:_Object$entries.map(_ref=>{let[key,value]=_ref;return{label:(0,common/* capitalize */.ZH)(key),value:value};})})}),/*#__PURE__*/(0,jsx_runtime.jsx)(es_form/* default */.A.Item,{name:"value",rules:[{required:true,message:"Please enter value"}],children:/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* CustomInput */.wi,{size:"w100",label:"Value",type:"text",asterisk:true})})]}),/*#__PURE__*/(0,jsx_runtime.jsxs)("div",{children:[/*#__PURE__*/(0,jsx_runtime.jsx)(es_form/* default */.A.Item,{name:"promoCode",rules:[{required:true,message:"Please enter promo code"}],children:/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* CustomInput */.wi,{size:"w100",label:"Promo Code",type:"text",asterisk:true})}),/*#__PURE__*/(0,jsx_runtime.jsx)(es_form/* default */.A.Item,{name:"limit",rules:[{required:true,message:"Please enter limit"}],children:/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* CustomInput */.wi,{size:"w100",label:"Limit",type:"text",asterisk:true})})]}),type==="new"&&/*#__PURE__*/(0,jsx_runtime.jsxs)("div",{children:[/*#__PURE__*/(0,jsx_runtime.jsx)(es_form/* default */.A.Item,{name:"packagesId",children:/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* CustomSelect */.Ae,{label:"Package",mode:"multiple",placeholder:"Please select a package",options:packages===null||packages===void 0?void 0:packages.map(_package=>({label:_package.localization[0].title,value:_package.id}))})}),/*#__PURE__*/(0,jsx_runtime.jsx)(es_form/* default */.A.Item,{name:"creditPackagesId",children:/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* CustomSelect */.Ae,{label:"Credit Package",mode:"multiple",placeholder:"Please select a credit package",options:creditPackages===null||creditPackages===void 0?void 0:creditPackages.map(_package=>({label:_package.localization[0].title,value:_package.id}))})})]}),/*#__PURE__*/(0,jsx_runtime.jsx)("div",{children:/*#__PURE__*/(0,jsx_runtime.jsxs)(es_form/* default */.A.Item,{name:"date",rules:[{required:true,message:"Please select date"}],children:[/*#__PURE__*/(0,jsx_runtime.jsxs)("label",{className:styles_module/* default */.A.label,children:["Date (Valid From  Valid To) ",/*#__PURE__*/(0,jsx_runtime.jsx)("span",{className:"color-red-yp",children:"*"})]}),/*#__PURE__*/(0,jsx_runtime.jsx)(RangePicker// onchange event handler
,{onChange:date=>{var _date$,_date$2;form.setFieldsValue({date:date});const validFrom=moment_default()(date&&((_date$=date[0])===null||_date$===void 0?void 0:_date$.toDate())).toISOString();const validTo=moment_default()(date&&((_date$2=date[1])===null||_date$2===void 0?void 0:_date$2.toDate())).toISOString();setDate({validFrom:validFrom,validTo:validTo});},placeholder:["Valid From","Valid To"],className:"w-100",defaultValue:type==="edit"?[moment_default()(recordData===null||recordData===void 0?void 0:(_recordData$data=recordData.data)===null||_recordData$data===void 0?void 0:_recordData$data.validFrom),moment_default()(recordData===null||recordData===void 0?void 0:recordData.data.validTo)]:[]})]})}),/*#__PURE__*/(0,jsx_runtime.jsxs)("div",{children:[/*#__PURE__*/(0,jsx_runtime.jsx)(es_form/* default */.A.Item,{name:"countryId",rules:[{required:true,message:"Please Select a country!"}],children:/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* CustomSelect */.Ae,{label:"Country",placeholder:"Please select country",options:countries===null||countries===void 0?void 0:countries.map(country=>({label:country.name,value:country.id})),asterisk:true})}),/*#__PURE__*/(0,jsx_runtime.jsx)(es_form/* default */.A.Item,{name:"isPublished",children:/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* CustomSelect */.Ae,{label:"Published",options:[{value:true,label:"Yes"},{value:false,label:"No"}]})})]}),/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* Localization */.G4,{title:"Promotion",formName:"translations",description:true,form:form,defaultValue:recordData===null||recordData===void 0?void 0:(_recordData$data2=recordData.data)===null||_recordData$data2===void 0?void 0:_recordData$data2.localization}),/*#__PURE__*/(0,jsx_runtime.jsx)("div",{children:/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* ImageUploader */.GA,{title:"Image",name:"image",defaultFileList:type==="edit"&&recordData&&((_recordData$data3=recordData.data)===null||_recordData$data3===void 0?void 0:_recordData$data3.image)&&[{uid:(_recordData$data4=recordData.data)===null||_recordData$data4===void 0?void 0:_recordData$data4.id,name:(_recordData$data5=recordData.data)===null||_recordData$data5===void 0?void 0:_recordData$data5.image,status:"done",url:constants/* RESOURCE_BASE_URL */.to+((_recordData$data6=recordData.data)===null||_recordData$data6===void 0?void 0:_recordData$data6.image)}]})}),/*#__PURE__*/(0,jsx_runtime.jsxs)("div",{className:styles_module/* default */.A.footer,children:[/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* CustomButton */.Sv,{size:"normal",fontSize:"sm",onClick:onCancel,type:"plain",children:"Cancel"}),/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* CustomButton */.Sv,{type:"primary",size:"normal",fontSize:"sm",htmlType:"submit",loading:recordData===null||recordData===void 0?void 0:recordData.buttonLoading,children:"Submit"})]})]})});};
// EXTERNAL MODULE: ./node_modules/antd/es/typography/index.js + 15 modules
var typography = __webpack_require__(30377);
// EXTERNAL MODULE: ./node_modules/antd/es/popconfirm/index.js + 1 modules
var popconfirm = __webpack_require__(56231);
// EXTERNAL MODULE: ./node_modules/antd/es/card/index.js + 3 modules
var card = __webpack_require__(2557);
// EXTERNAL MODULE: ./node_modules/antd/es/image/index.js + 13 modules
var es_image = __webpack_require__(9206);
// EXTERNAL MODULE: ./node_modules/antd/es/table/index.js + 96 modules
var table = __webpack_require__(41821);
// EXTERNAL MODULE: ./node_modules/@ant-design/icons/es/icons/DeleteOutlined.js
var DeleteOutlined = __webpack_require__(78433);
// EXTERNAL MODULE: ./src/Components/Atoms/Headings/index.tsx
var Headings = __webpack_require__(35751);
// EXTERNAL MODULE: ./src/helpers/dateHandler.ts
var dateHandler = __webpack_require__(98933);
// EXTERNAL MODULE: ./src/Components/Atoms/Switch/index.tsx
var Switch = __webpack_require__(44394);
// EXTERNAL MODULE: ./src/Components/Icons/index.tsx + 58 modules
var Icons = __webpack_require__(63668);
// EXTERNAL MODULE: ./node_modules/react-redux/es/index.js + 21 modules
var es = __webpack_require__(98341);
;// ./src/Components/Organisms/SiteSettings/Promotion/table-columns.tsx
// import { PromotionStatus } from "../../../../helpers/commonEnums";
const{Paragraph}=typography/* default */.A;const ActionComponent=props=>{const{record,onEditIconClick,reloadTableData,permissions:{deletePromotion}}=props;const[actionState,setActionState]=(0,react.useState)({confirmLoading:false,openPopConfirm:false});const module=(0,react.useMemo)(()=>new PromotionModule(),[]);const handleDelete=()=>{setActionState((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},actionState),{},{confirmLoading:true}));if(deletePromotion===false){message/* default */.Ay.error("You don't have permission to delete this record, please contact your admin.");setActionState((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},actionState),{},{openPopConfirm:false}));return;}module.deleteRecord(record.id).then(res=>{setActionState((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},actionState),{},{openPopConfirm:false,confirmLoading:false}));reloadTableData();}).catch(err=>{setActionState((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},actionState),{},{confirmLoading:false}));});};const showPopconfirm=()=>{setActionState((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},actionState),{},{openPopConfirm:true}));};return/*#__PURE__*/(0,jsx_runtime.jsxs)("div",{className:styles_module/* default */.A.actions,children:[/*#__PURE__*/(0,jsx_runtime.jsx)("span",{onClick:()=>onEditIconClick(record),children:/*#__PURE__*/(0,jsx_runtime.jsx)("img",{src:"/images/editicon.svg",alt:""})}),/*#__PURE__*/(0,jsx_runtime.jsx)(popconfirm/* default */.A,{open:actionState.openPopConfirm,placement:"top",title:"Are you sure?",onConfirm:handleDelete,onCancel:()=>setActionState((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},actionState),{},{openPopConfirm:false})),okButtonProps:{loading:actionState.confirmLoading},okText:"Yes",cancelText:"No",onOpenChange:visible=>{if(!visible){setActionState((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},actionState),{},{openPopConfirm:false}));}},children:/*#__PURE__*/(0,jsx_runtime.jsx)(DeleteOutlined/* default */.A,{className:styles_module/* default */.A.bg__red,onClick:showPopconfirm})})]});};function TableComponent(props){const{tableData,tableLoading,onEditIconClick,reloadTableData,onManageClick}=props;const{userPermissions}=(0,es/* useSelector */.d4)(state=>state.usersReducer);const permissions=userPermissions;const module=new PromotionModule();const today=new Date();const onIsPublishedChange=(checked,recordId)=>{return module.updateRecord({isPublished:checked},recordId);};/** Get the status of the promotion based on the start and end date
	 * @param {Date} validFrom start date of the promotion
	 * @param {Date} validTo end date of the promotion
	 * @returns {string} status of the promotion
	 */const promoCodeStatus=(validFrom,validTo)=>{const currentTime=today.getTime();const validToTime=new Date(validTo).getTime();const validFromTime=new Date(validFrom).getTime();if(validToTime>=currentTime&&currentTime>=validFromTime){return"active";}else if(validFromTime>=currentTime){return"upcoming";}else{return"expired";}};const columns=[{title:"S.No",dataIndex:"index",key:"index",render:(text,record,index)=>index+1,width:"5%"},{title:"Title",dataIndex:"localization",key:"localization",render:(localization,record)=>/*#__PURE__*/(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[/*#__PURE__*/(0,jsx_runtime.jsx)(Headings/* default */.A,{color:"dark-main",size:"sm",weight:"bold",children:localization[0].title}),/*#__PURE__*/(0,jsx_runtime.jsx)(Paragraph,{ellipsis:{rows:3,expandable:true,symbol:"view description"},title:localization[0].title,className:"font-size-xs color-light-800 mt-1",children:/*#__PURE__*/(0,jsx_runtime.jsx)("div",{dangerouslySetInnerHTML:{__html:localization[0].description}})}),/*#__PURE__*/(0,jsx_runtime.jsxs)("div",{className:"d-flex",children:[/*#__PURE__*/(0,jsx_runtime.jsx)(Icons/* CalenderIcon */.e$,{className:"mr-1",width:16,height:16}),/*#__PURE__*/(0,jsx_runtime.jsx)("span",{className:"font-size-xs color-dark-sub my-auto",children:(0,dateHandler/* convertDate */.ic)(record===null||record===void 0?void 0:record.addedDate,"M dd,yy")})]})]}),width:"12%"},{title:"Discount",dataIndex:"discountType",key:"discountType",render:(discountType,record)=>/*#__PURE__*/(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[/*#__PURE__*/(0,jsx_runtime.jsx)(Headings/* default */.A,{color:"dark-sub",size:"sm",children:"Type: ".concat((0,common/* capitalize */.ZH)(discountType))}),/*#__PURE__*/(0,jsx_runtime.jsx)(Headings/* default */.A,{color:"dark-sub",size:"sm",className:"mt-1",children:"value: ".concat(record.value)})]})},{title:"Promo",dataIndex:"promoCode",key:"promoCode",render:(promoCode,record)=>/*#__PURE__*/(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[/*#__PURE__*/(0,jsx_runtime.jsx)(Paragraph,{ellipsis:{rows:2,expandable:false},copyable:{text:promoCode},className:"font-size-sm color-dark-sub mt-1 mb-1",children:"Promo Code: ".concat(promoCode)}),/*#__PURE__*/(0,jsx_runtime.jsx)(Headings/* default */.A,{color:"dark-sub",size:"sm",children:"Valid From: ".concat((0,dateHandler/* convertDate */.ic)(record.validFrom,"dd M,yy"))}),/*#__PURE__*/(0,jsx_runtime.jsx)(Headings/* default */.A,{color:"dark-sub",size:"sm",className:"mt-1",children:"Valid Till: ".concat((0,dateHandler/* convertDate */.ic)(record.validTo,"dd M,yy"))}),/*#__PURE__*/(0,jsx_runtime.jsx)("div",{})]}),width:"15%"},{title:"Packages",dataIndex:"packages",key:"packages",render:(packages,record)=>{var _record$creditPackage,_record$creditPackage2,_record$packagePromot,_record$packagePromot2;return/*#__PURE__*/(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[/*#__PURE__*/(0,jsx_runtime.jsx)(card/* default */.A,{size:"small",title:/*#__PURE__*/(0,jsx_runtime.jsxs)("div",{className:"d-flex justify-space-between",children:[/*#__PURE__*/(0,jsx_runtime.jsx)("h5",{className:"color-dark-main",children:"Credit Package"}),/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* CustomButton */.Sv,{size:"xs",type:"plain_underlined",onClick:()=>{onManageClick(record,"credit");},disabled:permissions.updatePromotion===false,children:"Manage"})]}),children:(record===null||record===void 0?void 0:(_record$creditPackage=record.creditPackagePromotions)===null||_record$creditPackage===void 0?void 0:_record$creditPackage.length)>0?record===null||record===void 0?void 0:(_record$creditPackage2=record.creditPackagePromotions)===null||_record$creditPackage2===void 0?void 0:_record$creditPackage2.map((item,index)=>{var _item$creditPackage,_item$creditPackage$l;return/*#__PURE__*/(0,jsx_runtime.jsx)("div",{className:"mb-1",children:/*#__PURE__*/(0,jsx_runtime.jsx)(Headings/* default */.A,{color:"dark-sub",size:"sm",children:"".concat(item===null||item===void 0?void 0:(_item$creditPackage=item.creditPackage)===null||_item$creditPackage===void 0?void 0:(_item$creditPackage$l=_item$creditPackage.localization[0])===null||_item$creditPackage$l===void 0?void 0:_item$creditPackage$l.title)})},"creditPackagePromotions-".concat(index));}):/*#__PURE__*/(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:/*#__PURE__*/(0,jsx_runtime.jsx)("div",{className:"font-size-xs color-dark-sub text-center",children:"No Packages"})})}),/*#__PURE__*/(0,jsx_runtime.jsx)(card/* default */.A,{size:"small",title:/*#__PURE__*/(0,jsx_runtime.jsxs)("div",{className:"d-flex justify-space-between",children:[/*#__PURE__*/(0,jsx_runtime.jsx)("h5",{className:"color-dark-main",children:"Package"}),/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* CustomButton */.Sv,{size:"xs",type:"plain_underlined",onClick:()=>{onManageClick(record,"package");},disabled:permissions.updatePromotion===false,children:"Manage"})]}),className:"mt-2",children:(record===null||record===void 0?void 0:(_record$packagePromot=record.packagePromotions)===null||_record$packagePromot===void 0?void 0:_record$packagePromot.length)>0?record===null||record===void 0?void 0:(_record$packagePromot2=record.packagePromotions)===null||_record$packagePromot2===void 0?void 0:_record$packagePromot2.map((item,index)=>{var _item$package,_item$package$localiz;return/*#__PURE__*/(0,jsx_runtime.jsx)("div",{className:"mb-1",children:/*#__PURE__*/(0,jsx_runtime.jsx)(Headings/* default */.A,{color:"dark-sub",size:"sm",children:"".concat(item===null||item===void 0?void 0:(_item$package=item.package)===null||_item$package===void 0?void 0:(_item$package$localiz=_item$package.localization[0])===null||_item$package$localiz===void 0?void 0:_item$package$localiz.title)})},"packagePromotions-".concat(index));}):/*#__PURE__*/(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:/*#__PURE__*/(0,jsx_runtime.jsx)("div",{className:"font-size-xs color-dark-sub text-center",children:"No Packages"})})})]});},width:"25%"},{title:"Limit",dataIndex:"limit",key:"limit",render:limit=>/*#__PURE__*/(0,jsx_runtime.jsx)(Headings/* default */.A,{color:"dark-sub",size:"normal",children:limit}),className:"text-center"},{title:"Image",dataIndex:"image",key:"image",render:image=>image?/*#__PURE__*/(0,jsx_runtime.jsx)(es_image/* default */.A,{width:50,height:50,src:"".concat(constants/* RESOURCE_BASE_URL */.to).concat(image),alt:'Promotion Image',preview:false,rootClassName:"object-fit-contain"}):/*#__PURE__*/(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{})},{title:"Published",dataIndex:"isPublished",key:"isPublished",render:(checked,record)=>/*#__PURE__*/(0,jsx_runtime.jsx)(Switch/* Switch */.d,{checked:checked,onChange:onIsPublishedChange,recordId:record.id,allowChange:permissions.updatePromotion})},{title:"Actions",dataIndex:"actions",key:"actions",render:(text,record)=>/*#__PURE__*/(0,jsx_runtime.jsx)(ActionComponent,{record:record,onEditIconClick:onEditIconClick,reloadTableData:reloadTableData,permissions:permissions})}];return/*#__PURE__*/(0,jsx_runtime.jsx)("div",{className:styles_module/* default */.A.antdTableWrapper,children:/*#__PURE__*/(0,jsx_runtime.jsx)(table/* default */.A,{sticky:true,dataSource:tableData,columns:columns,pagination:false,scroll:{x:991},loading:tableLoading,rowKey:record=>"site-promotion-".concat(record.id)})});}
// EXTERNAL MODULE: ./node_modules/antd/es/transfer/index.js + 5 modules
var transfer = __webpack_require__(97579);
;// ./src/Components/Organisms/SiteSettings/Promotion/ManagePackages/modal.tsx
const ManagePackagesModal=props=>{var _creditPackagesData$d,_packagesData$data;const{openModal,onCancel,record,reloadTableData,recordData,type}=props;const[form]=es_form/* default */.A.useForm();const creditPackageModule=(0,react.useMemo)(()=>new CreditsPackage/* CreditsPackageModule */.l(),[]);const creditPackagePromotions=(0,react.useMemo)(()=>new CreditsPackage/* CreditsPackagePromotion */.Q(),[]);const packageModule=(0,react.useMemo)(()=>new PackageModule(),[]);const packagePromotions=(0,react.useMemo)(()=>new PackagePromotion(),[]);const[creditPackagesData,setCreditPackagesData]=(0,react.useState)();const[packagesData,setPackagesData]=(0,react.useState)();let selectedKeys=[];if(recordData&&recordData){if(recordData&&type==="credit"){const creditPackagePromotions=recordData;creditPackagePromotions===null||creditPackagePromotions===void 0?void 0:creditPackagePromotions.map(ele=>selectedKeys.push(ele.creditPackageId.toString()));}else if(recordData&&type==="package"){const packagePromotions=recordData;packagePromotions===null||packagePromotions===void 0?void 0:packagePromotions.map(ele=>selectedKeys.push(ele.packageId.toString()));}}const[targetKeys,setTargetKeys]=(0,react.useState)(selectedKeys);const handleErrors=err=>{const error=(0,error_handler/* errorHandler */.r)(err);if(type==="credit"){if(typeof error.message=="string"){setCreditPackagesData((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},creditPackagesData),{},{error:error.message}));}else{let errData=(0,ServerErrorHandler/* HandleServerErrors */.p)(error.message,[]);form.setFields(errData);setCreditPackagesData((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},creditPackagesData),{},{error:""}));}}else if(type==="package"){if(typeof error.message=="string"){setPackagesData((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},packagesData),{},{error:error.message}));}else{let errData=(0,ServerErrorHandler/* HandleServerErrors */.p)(error.message,[]);form.setFields(errData);setPackagesData((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},packagesData),{},{error:""}));}}};const handleAlertClose=()=>{if(type==="credit"){setCreditPackagesData((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},creditPackagesData),{},{error:""}));}else if(type==="package"){setPackagesData((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},packagesData),{},{error:""}));}};const getData=(0,react.useCallback)(()=>{if(type==="credit"){creditPackageModule.getAllRecords().then(res=>{if(res.data&&res.data.data){setCreditPackagesData((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},res.data),{},{loading:false}));}}).catch(err=>{handleErrors(err);});}else if(type==="package"){packageModule.getAllRecords().then(res=>{if(res.data&&res.data.data){setPackagesData((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},res.data),{},{loading:false}));}}).catch(err=>{handleErrors(err);});}},[form,record,creditPackageModule,type,packageModule]);const filterOption=(inputValue,option)=>option.description.indexOf(inputValue.toLowerCase())>-1;const handleChange=newTargetKeys=>{setTargetKeys(newTargetKeys);};(0,react.useEffect)(()=>{setCreditPackagesData({loading:true});getData();},[openModal,form]);const onFinish=async formValues=>{if(formValues.creditPackageIds&&type==="credit"){var _formValues$creditPac;setCreditPackagesData((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},creditPackagesData),{},{buttonLoading:true}));const formData=formValues===null||formValues===void 0?void 0:(_formValues$creditPac=formValues.creditPackageIds)===null||_formValues$creditPac===void 0?void 0:_formValues$creditPac.map(ele=>Number(ele));setCreditPackagesData((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},creditPackagesData),{},{buttonLoading:false}));if(formData.length>0){await creditPackagePromotions.createRecord({creditPackageIds:formData,promotionId:record}).then(res=>{message/* default */.Ay.success("Saved Successfully");}).catch(err=>{handleErrors(err);setCreditPackagesData(prev=>(0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},prev),{},{loading:false}));});}let removedPackages=[];selectedKeys===null||selectedKeys===void 0?void 0:selectedKeys.map(ele=>!targetKeys.includes(ele)&&removedPackages.push(Number(ele)));if((removedPackages===null||removedPackages===void 0?void 0:removedPackages.length)>0){await creditPackagePromotions.deleteMultipleRecords(record,removedPackages).catch(err=>{message/* default */.Ay.error(err.message);});}reloadTableData();onCancel();setCreditPackagesData(prev=>(0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},prev),{},{loading:false}));}else if(formValues.packageIds&&type==="package"){var _formValues$packageId;setPackagesData((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},packagesData),{},{buttonLoading:true}));const formData=formValues===null||formValues===void 0?void 0:(_formValues$packageId=formValues.packageIds)===null||_formValues$packageId===void 0?void 0:_formValues$packageId.map(ele=>Number(ele));setPackagesData((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},packagesData),{},{buttonLoading:false}));if(formData.length>0){await packagePromotions.createRecord({packageIds:formData,promotionId:record}).then(res=>{message/* default */.Ay.success("Saved Successfully");}).catch(err=>{handleErrors(err);setPackagesData(prev=>(0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},prev),{},{loading:false}));});}let removedPackages=[];selectedKeys===null||selectedKeys===void 0?void 0:selectedKeys.map(ele=>!targetKeys.includes(ele)&&removedPackages.push(Number(ele)));if((removedPackages===null||removedPackages===void 0?void 0:removedPackages.length)>0){await packagePromotions.deleteMultipleRecords(record,removedPackages).catch(err=>{message/* default */.Ay.error(err.message);});}reloadTableData();onCancel();setPackagesData(prev=>(0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},prev),{},{loading:false}));}else{message/* default */.Ay.info("No changes made");onCancel();}};return/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* CustomModal */.jo,{visible:openModal,closable:true,onCancel:onCancel,titleText:type==="credit"?"Manage Credit Packages":"Manage Packages",showFooter:false,children:type==="credit"&&creditPackagesData!==null&&creditPackagesData!==void 0&&creditPackagesData.loading||type==="package"&&packagesData!==null&&packagesData!==void 0&&packagesData.loading?/*#__PURE__*/(0,jsx_runtime.jsx)(Skeletons/* default */.A,{items:10}):/*#__PURE__*/(0,jsx_runtime.jsxs)(es_form/* default */.A,{className:styles_module/* default */.A.form,onFinish:onFinish,form:form,children:[type==="credit"&&/*#__PURE__*/(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(creditPackagesData===null||creditPackagesData===void 0?void 0:creditPackagesData.error)&&/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* CustomErrorAlert */.WZ,{description:creditPackagesData===null||creditPackagesData===void 0?void 0:creditPackagesData.error,isClosable:true,onClose:handleAlertClose}),/*#__PURE__*/(0,jsx_runtime.jsx)("div",{children:/*#__PURE__*/(0,jsx_runtime.jsx)(es_form/* default */.A.Item,{name:"creditPackageIds",rules:[{required:false}],children:/*#__PURE__*/(0,jsx_runtime.jsx)(transfer/* default */.A,{dataSource:creditPackagesData===null||creditPackagesData===void 0?void 0:(_creditPackagesData$d=creditPackagesData.data)===null||_creditPackagesData$d===void 0?void 0:_creditPackagesData$d.map((ele,index)=>{var _ele$localization$0$t;return{key:ele.id.toString(),title:ele.localization[0].title,description:(_ele$localization$0$t=ele.localization[0].title)===null||_ele$localization$0$t===void 0?void 0:_ele$localization$0$t.toLowerCase()};}),listStyle:{width:250,height:400},showSearch:true,filterOption:filterOption,targetKeys:targetKeys,onChange:handleChange,render:item=>item.title})})}),/*#__PURE__*/(0,jsx_runtime.jsxs)("div",{className:styles_module/* default */.A.footer,children:[/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* CustomButton */.Sv,{size:"normal",fontSize:"sm",onClick:onCancel,type:"plain",children:"Cancel"}),/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* CustomButton */.Sv,{type:"primary",size:"normal",fontSize:"sm",htmlType:"submit",loading:creditPackagesData===null||creditPackagesData===void 0?void 0:creditPackagesData.buttonLoading,children:"Save"})]})]}),type==="package"&&/*#__PURE__*/(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(packagesData===null||packagesData===void 0?void 0:packagesData.error)&&/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* CustomErrorAlert */.WZ,{description:packagesData===null||packagesData===void 0?void 0:packagesData.error,isClosable:true,onClose:handleAlertClose}),/*#__PURE__*/(0,jsx_runtime.jsx)("div",{children:/*#__PURE__*/(0,jsx_runtime.jsx)(es_form/* default */.A.Item,{name:"packageIds",rules:[{required:false}],children:/*#__PURE__*/(0,jsx_runtime.jsx)(transfer/* default */.A,{dataSource:packagesData===null||packagesData===void 0?void 0:(_packagesData$data=packagesData.data)===null||_packagesData$data===void 0?void 0:_packagesData$data.map((ele,index)=>{var _ele$localization$0$t2;return{key:ele.id.toString(),title:ele.localization[0].title,description:(_ele$localization$0$t2=ele.localization[0].title)===null||_ele$localization$0$t2===void 0?void 0:_ele$localization$0$t2.toLowerCase()};}),listStyle:{width:250,height:400},showSearch:true,filterOption:filterOption,targetKeys:targetKeys,onChange:handleChange,render:item=>item.title})})}),/*#__PURE__*/(0,jsx_runtime.jsxs)("div",{className:styles_module/* default */.A.footer,children:[/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* CustomButton */.Sv,{size:"normal",fontSize:"sm",onClick:onCancel,type:"plain",children:"Cancel"}),/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* CustomButton */.Sv,{type:"primary",size:"normal",fontSize:"sm",htmlType:"submit",loading:packagesData===null||packagesData===void 0?void 0:packagesData.buttonLoading,children:"Save"})]})]})]})});};
// EXTERNAL MODULE: ./src/helpers/useDebounce.ts
var useDebounce = __webpack_require__(28173);
;// ./src/Modules/Promotion/permissions.ts
let PromotionPermissionsEnum=/*#__PURE__*/function(PromotionPermissionsEnum){PromotionPermissionsEnum["CREATE"]="createPromotion";PromotionPermissionsEnum["UPDATE"]="updatePromotion";PromotionPermissionsEnum["DELETE"]="deletePromotion";PromotionPermissionsEnum["READ"]="readPromotion";return PromotionPermissionsEnum;}({});
// EXTERNAL MODULE: ./src/Components/Atoms/ErrorCodes/index.tsx + 1 modules
var ErrorCodes = __webpack_require__(36250);
;// ./src/Components/Organisms/SiteSettings/Promotion/index.tsx
// import { PromotionDiscountType, PromotionStatus } from "../../../../helpers/commonEnums";
const breadCrumbsData=[{text:"Home",isLink:true,path:"/"},{isLink:true,text:"Site Settings",path:"/siteSettings"},{isLink:false,text:"Promotion"}];function SitePromotionSettings(){var _moduleData$meta,_moduleData$meta2,_moduleData$meta3,_moduleData$meta4;// available permissions for this module
const permissionSlug=(0,common/* getPermissionSlugs */.AH)(PromotionPermissionsEnum);const{userPermissions}=(0,es/* useSelector */.d4)(state=>state.usersReducer);const permissions=userPermissions;const{createPromotion,readPromotion,updatePromotion}=permissions;const[currentEditType,setcurrentEditType]=(0,react.useState)({editType:"new",recordId:0,openModal:false});const module=(0,react.useMemo)(()=>new PromotionModule(),[]);const countryModule=(0,react.useMemo)(()=>new Country/* CountryModule */.j(),[]);const[searchTerm,setSearchTerm]=(0,react.useState)("");const debouncedSearchTerm=(0,useDebounce/* useDebounce */.d)(searchTerm,500);const[selectedFilters,setSelectedFilters]=(0,react.useState)({promoCode:"",discountType:"",country:0,isPublished:undefined,status:""});const[countries,setCountries]=(0,react.useState)([]);const[reset,setReset]=(0,react.useState)(false);const onSelected=event=>{const{name,value}=event===null||event===void 0?void 0:event.target;// set the selected value in the state 
setSelectedFilters((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},selectedFilters),{},{[name]:value}));};const onReset=(0,react.useCallback)((name,value)=>{if(name){setReset(true);setSelectedFilters((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},selectedFilters),{},{[name]:value}));}},[selectedFilters]);const onSearch=event=>{const value=event.currentTarget.value;setSearchTerm(value);};const[moduleData,setModuleData]=(0,react.useState)({isLoading:false,error:{},data:[]});const[managePackages,setManagePackages]=(0,react.useState)({recordId:0,openModal:false,recordData:{},type:"credit"});// event handle  to open and close modal
const handleClick=()=>{if(createPromotion===false){message/* default */.Ay.error("You don't have permission to create new record");return;}setcurrentEditType((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},currentEditType),{},{openModal:!currentEditType.openModal,editType:"new"}));};const onEditIconClick=record=>{if(updatePromotion===false){message/* default */.Ay.error("You don't have permission to update this record");return;}setcurrentEditType((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},currentEditType),{},{editType:"edit",recordId:record.id,openModal:true}));};const onManageClick=(record,type)=>{if(updatePromotion===false){message/* default */.Ay.error("You don't have permission to manage this record");return;}setManagePackages((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},managePackages),{},{recordId:record.id,recordData:type==="credit"?record['creditPackagePromotions']:record['packagePromotions'],openModal:true,type:type}));};const reloadTableData=query=>{setModuleData((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},moduleData),{},{loading:true}));module.getAllRecords(query).then(res=>{setModuleData(res.data);}).catch(err=>{setModuleData((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},moduleData),{},{loading:false}));});};const onUpdate=(0,react.useCallback)(()=>{var _selectedFilters$date,_selectedFilters$date2;const fromDateString=((_selectedFilters$date=selectedFilters.dateRange)===null||_selectedFilters$date===void 0?void 0:_selectedFilters$date[0])||"";const toDateString=((_selectedFilters$date2=selectedFilters.dateRange)===null||_selectedFilters$date2===void 0?void 0:_selectedFilters$date2[1])||"";const fromDate=fromDateString?(0,dateHandler/* convertDate */.ic)(fromDateString,"yy-mm-dd"):undefined;const toDate=toDateString?(0,dateHandler/* convertDate */.ic)(toDateString,"yy-mm-dd"):undefined;const data={promoCode:selectedFilters.promoCode||undefined,discountType:selectedFilters.discountType||undefined,country:selectedFilters.country||undefined,isPublished:selectedFilters.isPublished||undefined,status:selectedFilters.status||undefined,title:debouncedSearchTerm||undefined,fromDate:fromDate,toDate:toDate};reloadTableData(data);},[selectedFilters,debouncedSearchTerm]);const onPaginationChange=(0,react.useCallback)((page,pageSize)=>{var _selectedFilters$date3,_selectedFilters$date4;const fromDateString=((_selectedFilters$date3=selectedFilters.dateRange)===null||_selectedFilters$date3===void 0?void 0:_selectedFilters$date3[0])||"";const toDateString=((_selectedFilters$date4=selectedFilters.dateRange)===null||_selectedFilters$date4===void 0?void 0:_selectedFilters$date4[1])||"";const fromDate=fromDateString?(0,dateHandler/* convertDate */.ic)(fromDateString,"yy-mm-dd"):undefined;const toDate=toDateString?(0,dateHandler/* convertDate */.ic)(toDateString,"yy-mm-dd"):undefined;const params={page,perPage:pageSize,promoCode:selectedFilters.promoCode||undefined,discountType:selectedFilters.discountType||undefined,country:selectedFilters.country||undefined,isPublished:selectedFilters.isPublished||undefined,status:selectedFilters.status||undefined,title:debouncedSearchTerm||undefined,fromDate:fromDate,toDate:toDate};reloadTableData(params);},[selectedFilters,debouncedSearchTerm]);(0,react.useEffect)(()=>{countryModule.getAllRecords().then(res=>{setCountries(res.data.data);}).catch(err=>{var _err$response,_err$response$data;console.error((err===null||err===void 0?void 0:(_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.message)||(err===null||err===void 0?void 0:err.message));});},[countryModule]);// NOTE: this is not a good way to do this, but it works for now
(0,react.useEffect)(()=>{if(debouncedSearchTerm){onUpdate();}else{onUpdate();}},[debouncedSearchTerm]);(0,react.useEffect)(()=>{if(reset){onUpdate();}// after 2 seconds set reset clicked state to false
const timer=setTimeout(()=>{setReset(false);},2000);return()=>clearTimeout(timer);},[reset,selectedFilters,onUpdate]);return/*#__PURE__*/(0,jsx_runtime.jsxs)(SiteSettings["default"],{permissionSlug:permissionSlug,children:[/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* PageHeader */.zY,{heading:"Promotion",buttonText:"New Promotion",onButtonClick:handleClick,breadCrumbData:breadCrumbsData,showAdd:createPromotion===true?true:false,filters:readPromotion===true?/*#__PURE__*/(0,jsx_runtime.jsxs)("div",{children:[/*#__PURE__*/(0,jsx_runtime.jsx)("div",{children:/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* CustomInput */.wi,{placeHolder:"Search...",icon:/*#__PURE__*/(0,jsx_runtime.jsx)("img",{src:"/images/searchIcon.svg",alt:"Search Icon"}),size:"w100",className:"py-1",value:searchTerm,onChange:onSearch})}),/*#__PURE__*/(0,jsx_runtime.jsx)("div",{children:/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* CustomFilter */.YH,{type:"radio",label:"Discount Type",name:"discountType",value:selectedFilters===null||selectedFilters===void 0?void 0:selectedFilters.discountType,options:[],onChange:onSelected,onReset:()=>onReset("discountType",""),onUpdate:onUpdate})}),/*#__PURE__*/(0,jsx_runtime.jsx)("div",{children:/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* CustomFilter */.YH,{type:"input",label:"Promo Code",name:"promoCode",value:selectedFilters===null||selectedFilters===void 0?void 0:selectedFilters.promoCode,onChange:onSelected,onReset:()=>onReset("promoCode",""),onUpdate:onUpdate})}),/*#__PURE__*/(0,jsx_runtime.jsx)("div",{children:/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* CustomFilter */.YH,{type:"radio",label:"Status",name:"status",value:selectedFilters===null||selectedFilters===void 0?void 0:selectedFilters.status,options:[],onChange:onSelected,onReset:()=>onReset("status",""),onUpdate:onUpdate})}),/*#__PURE__*/(0,jsx_runtime.jsx)("div",{children:/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* CustomFilter */.YH,{type:"radio",label:"Published",name:"isPublished",options:[{label:"Yes",value:"true"},{label:"No",value:"false"}],value:String(selectedFilters===null||selectedFilters===void 0?void 0:selectedFilters.isPublished),onChange:onSelected,onReset:()=>onReset("isPublished",""),onUpdate:onUpdate})}),/*#__PURE__*/(0,jsx_runtime.jsx)("div",{children:/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* CustomFilter */.YH,{type:"datepicker",label:"Date",name:"dateRange",onChange:value=>{setSelectedFilters((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},selectedFilters),{},{dateRange:value}));},onReset:()=>onReset("dateRange",[]),onUpdate:onUpdate})}),/*#__PURE__*/(0,jsx_runtime.jsx)("div",{children:/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* CustomFilter */.YH,{type:"radio",label:"Country",name:"country",value:String(selectedFilters===null||selectedFilters===void 0?void 0:selectedFilters.country),options:countries===null||countries===void 0?void 0:countries.map(country=>({label:country.name,value:String(country.id)})),onChange:onSelected,onReset:()=>onReset("country",""),onUpdate:onUpdate})})]}):null}),readPromotion===true&&/*#__PURE__*/(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[/*#__PURE__*/(0,jsx_runtime.jsx)(TableComponent,{tableData:moduleData.data,tableLoading:moduleData.loading,onEditIconClick:onEditIconClick,reloadTableData:reloadTableData,onManageClick:onManageClick}),/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* Pagination */.dK,{total:moduleData===null||moduleData===void 0?void 0:(_moduleData$meta=moduleData.meta)===null||_moduleData$meta===void 0?void 0:_moduleData$meta.total,current:moduleData===null||moduleData===void 0?void 0:(_moduleData$meta2=moduleData.meta)===null||_moduleData$meta2===void 0?void 0:_moduleData$meta2.page,defaultPageSize:moduleData!==null&&moduleData!==void 0&&(_moduleData$meta3=moduleData.meta)!==null&&_moduleData$meta3!==void 0&&_moduleData$meta3.perPage?moduleData===null||moduleData===void 0?void 0:(_moduleData$meta4=moduleData.meta)===null||_moduleData$meta4===void 0?void 0:_moduleData$meta4.perPage:10,pageSizeOptions:[10,20,50,100],onChange:onPaginationChange})]}),readPromotion===false&&/*#__PURE__*/(0,jsx_runtime.jsx)(ErrorCodes/* ErrorCode403 */.$t,{mainMessage:"You don't have permission to view this data"}),currentEditType.openModal&&/*#__PURE__*/(0,jsx_runtime.jsx)(SitePromotionModal,{record:currentEditType.recordId,type:currentEditType.editType,reloadTableData:reloadTableData,onCancel:handleClick,openModal:currentEditType.openModal,permissions:permissions}),managePackages.openModal&&/*#__PURE__*/(0,jsx_runtime.jsx)(ManagePackagesModal,{record:managePackages.recordId,recordData:managePackages.recordData,type:managePackages.type,reloadTableData:reloadTableData,onCancel:()=>setManagePackages((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},managePackages),{},{openModal:false})),openModal:managePackages.openModal})]});}/* harmony default export */ const Promotion = (SitePromotionSettings);

/***/ }),

/***/ 83584:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   j: () => (/* binding */ CountryModule)
/* harmony export */ });
/* harmony import */ var _services_axiosInstance__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(83365);
/* harmony import */ var _Common_config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(21073);
class CountryModule{constructor(){this.endPoint="country";this.allEndpoint="country/all";this.getAllRecords=()=>{return _services_axiosInstance__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .A.get(this.allEndpoint);};this.getAvailableRecords=()=>{return _services_axiosInstance__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .A.get("".concat(this.endPoint,"/available-country"));};this.getRecordById=id=>{return _services_axiosInstance__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .A.get("".concat(this.endPoint,"/").concat(id));};this.deleteRecord=id=>{return _services_axiosInstance__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .A.delete("".concat(this.endPoint,"/").concat(id));};this.createRecord=data=>{return _services_axiosInstance__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .A.post(this.endPoint+"/",data,{headers:_Common_config__WEBPACK_IMPORTED_MODULE_1__/* .FormDataHeader */ .Y});};this.updateRecord=(data,id)=>{return _services_axiosInstance__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .A.patch("".concat(this.endPoint,"/").concat(id),data,{headers:_Common_config__WEBPACK_IMPORTED_MODULE_1__/* .FormDataHeader */ .Y});};}}

/***/ }),

/***/ 86560:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   Q: () => (/* binding */ CreditsPackagePromotion),
/* harmony export */   l: () => (/* binding */ CreditsPackageModule)
/* harmony export */ });
/* harmony import */ var _services_axiosInstance__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(83365);
/* harmony import */ var _Common_config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(21073);
class CreditsPackageModule{constructor(){this.endPoint="credit-package";this.createRecord=data=>{return _services_axiosInstance__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .A.post(this.endPoint+"/",data,{headers:_Common_config__WEBPACK_IMPORTED_MODULE_1__/* .FormDataHeader */ .Y});};this.getAllRecords=()=>{return _services_axiosInstance__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .A.get(this.endPoint);};this.getAllPublished=()=>{return _services_axiosInstance__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .A.get(this.endPoint+"/findPublished");};this.getRecordById=id=>{return _services_axiosInstance__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .A.get("".concat(this.endPoint,"/").concat(id,"?all=true"));};this.updateRecord=(data,id)=>{return _services_axiosInstance__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .A.patch("".concat(this.endPoint,"/").concat(id),data,{headers:_Common_config__WEBPACK_IMPORTED_MODULE_1__/* .FormDataHeader */ .Y});};this.deleteRecord=id=>{return _services_axiosInstance__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .A.delete("".concat(this.endPoint,"/").concat(id));};}}class CreditsPackagePromotion{constructor(){this.endPoint="credit-package-promotions";this.createRecord=data=>{return _services_axiosInstance__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .A.post(this.endPoint+"/",data);};this.getAllRecords=()=>{return _services_axiosInstance__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .A.get(this.endPoint);};this.getRecordById=promotionId=>{return _services_axiosInstance__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .A.get("".concat(this.endPoint,"/").concat(promotionId));};this.deleteMultipleRecords=(promotionId,packageIds)=>{return _services_axiosInstance__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .A.delete("".concat(this.endPoint,"/removeMultiple/").concat(promotionId),{params:{packageIds}});};this.deleteRecordById=(promotionId,creditPackageId)=>{return _services_axiosInstance__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .A.delete("".concat(this.endPoint,"/").concat(promotionId,"/").concat(creditPackageId));};this.updateRecord=data=>{return _services_axiosInstance__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .A.patch(this.endPoint+"/",data);};}}

/***/ })

}]);