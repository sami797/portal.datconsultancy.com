"use strict";
(self["webpackChunkdat_projects"] = self["webpackChunkdat_projects"] || []).push([[3549],{

/***/ 53549:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__);

// EXPORTS
__webpack_require__.d(__webpack_exports__, {
  "default": () => (/* binding */ Deals)
});

// EXTERNAL MODULE: ./node_modules/@babel/runtime/helpers/esm/objectSpread2.js
var objectSpread2 = __webpack_require__(89379);
// EXTERNAL MODULE: ./node_modules/react/index.js
var react = __webpack_require__(9950);
// EXTERNAL MODULE: ./src/Components/Templates/Layout/index.tsx + 28 modules
var Layout = __webpack_require__(81168);
// EXTERNAL MODULE: ./node_modules/antd/es/spin/index.js
var spin = __webpack_require__(90650);
// EXTERNAL MODULE: ./node_modules/antd/es/empty/index.js + 2 modules
var empty = __webpack_require__(90247);
;// ./src/Components/Organisms/Dashboard/Deals/styles.module.scss
// extracted by mini-css-extract-plugin
/* harmony default export */ const styles_module = ({"dragger":"styles_dragger__y84s6","numberOfUploads":"styles_numberOfUploads__opO4a","mediaContainer":"styles_mediaContainer__7nlVp","image":"styles_image__1KjCq","mediaPreviewContainer":"styles_mediaPreviewContainer__Ogr6L","playIcon":"styles_playIcon__BeZIq","mediaPreview":"styles_mediaPreview__96tvm","mediaDetails":"styles_mediaDetails__1mCAv","cards":"styles_cards__w2-Jp","card":"styles_card__dTGCs","headerBg":"styles_headerBg__LZFS3","header":"styles_header__riNoK","user":"styles_user__cou7f","profile":"styles_profile__-Z+ix","name":"styles_name__EXcVt","actions":"styles_actions__12SNA","icon":"styles_icon__g6atJ","textContainer":"styles_textContainer__zhO4H","date":"styles_date__KnQ-Y","caption":"styles_caption__rL-Nw"});
// EXTERNAL MODULE: ./node_modules/antd/es/message/index.js + 1 modules
var message = __webpack_require__(92759);
// EXTERNAL MODULE: ./node_modules/antd/es/popconfirm/index.js + 1 modules
var popconfirm = __webpack_require__(56231);
// EXTERNAL MODULE: ./src/services/axiosInstance.ts
var axiosInstance = __webpack_require__(83365);
// EXTERNAL MODULE: ./src/helpers/constants.ts
var constants = __webpack_require__(65944);
// EXTERNAL MODULE: ./src/helpers/dateHandler.ts
var dateHandler = __webpack_require__(98933);
// EXTERNAL MODULE: ./src/Components/Icons/index.tsx + 58 modules
var Icons = __webpack_require__(63668);
// EXTERNAL MODULE: ./src/Modules/Properties/index.ts
var Properties = __webpack_require__(40743);
// EXTERNAL MODULE: ./src/Components/Atoms/index.tsx + 12 modules
var Atoms = __webpack_require__(9394);
// EXTERNAL MODULE: ./node_modules/antd/es/modal/index.js + 7 modules
var modal = __webpack_require__(32645);
// EXTERNAL MODULE: ./node_modules/react/jsx-runtime.js
var jsx_runtime = __webpack_require__(44414);
;// ./src/Components/Organisms/Dashboard/Deals/modal/video-player.tsx
const VideoPlayer=_ref=>{let{visible,handleCancel,src}=_ref;const deviceWidth=window.innerWidth;return/*#__PURE__*/(0,jsx_runtime.jsx)(modal/* default */.A,{visible:visible,onCancel:handleCancel,footer:null,afterClose:()=>{// reset the video when the modal is closed
if(src){const video=document.querySelector("video");if(video){video.currentTime=0;}}},width:deviceWidth>500?550:deviceWidth,destroyOnClose:true,children:/*#__PURE__*/(0,jsx_runtime.jsx)("video",{width:"100%",height:"auto",controls:true,src:src,autoPlay:visible})});};/* harmony default export */ const video_player = (VideoPlayer);
;// ./src/Components/Organisms/Dashboard/Deals/card.tsx
const EditIcon=props=>{return/*#__PURE__*/(0,jsx_runtime.jsxs)("svg",(0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none"},props),{},{children:[/*#__PURE__*/(0,jsx_runtime.jsx)("path",{d:"M11 2H9C4 2 2 4 2 9v6c0 5 2 7 7 7h6c5 0 7-2 7-7v-2",stroke:"#ffffff",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),/*#__PURE__*/(0,jsx_runtime.jsx)("path",{d:"M16.04 3.02 8.16 10.9c-.3.3-.6.89-.66 1.32l-.43 3.01c-.16 1.09.61 1.85 1.7 1.7l3.01-.43c.42-.06 1.01-.36 1.32-.66l7.88-7.88c1.36-1.36 2-2.94 0-4.94-2-2-3.58-1.36-4.94 0Z",stroke:"#ffffff",strokeWidth:"1.5",strokeMiterlimit:"10",strokeLinecap:"round",strokeLinejoin:"round"}),/*#__PURE__*/(0,jsx_runtime.jsx)("path",{d:"M14.91 4.15a7.144 7.144 0 0 0 4.94 4.94",stroke:"#ffffff",strokeWidth:"1.5",strokeMiterlimit:"10",strokeLinecap:"round",strokeLinejoin:"round"})]}));};const PlayIcon=props=>{return/*#__PURE__*/(0,jsx_runtime.jsx)("svg",(0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({width:"100",height:"100",viewBox:"-25 -25 200 200"},props),{},{children:/*#__PURE__*/(0,jsx_runtime.jsx)("g",{children:/*#__PURE__*/(0,jsx_runtime.jsx)("path",{d:"M34.857,3.613C20.084-4.861,8.107,2.081,8.107,19.106v125.637c0,17.042,11.977,23.975,26.75,15.509L144.67,97.275 c14.778-8.477,14.778-22.211,0-30.686L34.857,3.613z"})})}));};const DealCard=_ref=>{var _property$localizatio;let{data,reloadTableData,onEditIconClick}=_ref;const{id,mediaType,media,user,caption,addedDate,property,thumbnail}=data;const[actionState,setActionState]=(0,react.useState)({confirmLoading:false,openPopConfirm:false});const[isVideoOpen,setIsVideoOpen]=(0,react.useState)(false);const module=(0,react.useMemo)(()=>new Properties/* PropertyDealsModule */.h(),[]);const handleDelete=()=>{setActionState((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},actionState),{},{confirmLoading:true}));module.deleteRecord(id).then(()=>{setActionState((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},actionState),{},{openPopConfirm:false,confirmLoading:false}));reloadTableData();}).catch(err=>{message/* default */.Ay.error(err.message||"Something went wrong!");setActionState((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},actionState),{},{confirmLoading:false}));});};// Open Popconfirm
const showPopconfirm=()=>setActionState((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},actionState),{},{openPopConfirm:true}));return/*#__PURE__*/(0,jsx_runtime.jsxs)("div",{className:styles_module.card,children:[/*#__PURE__*/(0,jsx_runtime.jsx)("div",{className:styles_module.headerBg}),/*#__PURE__*/(0,jsx_runtime.jsxs)("div",{className:styles_module.header,children:[/*#__PURE__*/(0,jsx_runtime.jsxs)("div",{className:styles_module.user,children:[/*#__PURE__*/(0,jsx_runtime.jsx)("img",{src:"".concat(constants/* RESOURCE_BASE_URL */.to).concat(user.profile),alt:"".concat(user.firstName," ").concat(user.lastName),className:styles_module.profile}),/*#__PURE__*/(0,jsx_runtime.jsx)("h3",{className:styles_module.name,children:"".concat(user.firstName," ").concat(user.lastName)})]}),/*#__PURE__*/(0,jsx_runtime.jsxs)("div",{className:styles_module.actions,children:[/*#__PURE__*/(0,jsx_runtime.jsx)(EditIcon,{style:{cursor:"pointer"},onClick:()=>onEditIconClick(data)}),/*#__PURE__*/(0,jsx_runtime.jsx)(popconfirm/* default */.A,{open:actionState.openPopConfirm,placement:"top",title:"Are you sure?",onConfirm:handleDelete,onCancel:()=>setActionState((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},actionState),{},{openPopConfirm:false})),okButtonProps:{loading:actionState.confirmLoading},okText:"Yes",cancelText:"No",onOpenChange:visible=>{if(!visible){setActionState((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},actionState),{},{openPopConfirm:false}));}},children:/*#__PURE__*/(0,jsx_runtime.jsx)(Icons/* DeleteIcon */.d7,{style:{backgroundColor:"#fff",borderRadius:"50%",padding:"5px",cursor:"pointer"},onClick:showPopconfirm})})]})]}),/*#__PURE__*/(0,jsx_runtime.jsxs)("div",{className:styles_module.mediaContainer,children:[/*#__PURE__*/(0,jsx_runtime.jsx)("img",{src:mediaType==="image"?"".concat(constants/* RESOURCE_BASE_URL */.to).concat(media):"".concat(constants/* RESOURCE_BASE_URL */.to).concat(thumbnail),alt:caption,className:styles_module.image}),mediaType==="video"&&/*#__PURE__*/(0,jsx_runtime.jsx)(PlayIcon,{className:styles_module.playIcon,onClick:()=>setIsVideoOpen(true)}),mediaType==="video"&&/*#__PURE__*/(0,jsx_runtime.jsx)(video_player,{src:"".concat(axiosInstance/* BASE_URL */.C,"property-deals-resources/").concat(media),visible:isVideoOpen,handleCancel:()=>setIsVideoOpen(false)})]}),/*#__PURE__*/(0,jsx_runtime.jsxs)("div",{className:"d-flex justify-space-between mt-2",children:[/*#__PURE__*/(0,jsx_runtime.jsxs)("div",{className:"d-flex align-items-center",children:[/*#__PURE__*/(0,jsx_runtime.jsx)(Icons/* CalenderIcon */.e$,{className:"mr-2"}),/*#__PURE__*/(0,jsx_runtime.jsx)("p",{className:styles_module.date,children:(0,dateHandler/* convertDate */.ic)(addedDate,"dd M,yy-t")||"N/A"})]}),(property===null||property===void 0?void 0:property.slug)&&/*#__PURE__*/(0,jsx_runtime.jsxs)("a",{href:"".concat(constants/* FRONT_END_URL */.Yb,"/en/property/").concat(property.slug),target:"_blank",rel:"noreferrer",title:(_property$localizatio=property.localization[0])===null||_property$localizatio===void 0?void 0:_property$localizatio.title,className:"d-flex",children:[/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* Typography */.o5,{color:"dark-main",size:"sm",weight:"bold",children:"View Property:"}),/*#__PURE__*/(0,jsx_runtime.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",height:"16px",width:"17px",children:/*#__PURE__*/(0,jsx_runtime.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.5 6H5.25A2.25 2.25 0 003 8.25v10.5A2.25 2.25 0 005.25 21h10.5A2.25 2.25 0 0018 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"})})]})]}),/*#__PURE__*/(0,jsx_runtime.jsx)("div",{className:"d-flex justify-space-between mt-2",children:/*#__PURE__*/(0,jsx_runtime.jsx)("p",{className:styles_module.caption,children:caption})})]});};/* harmony default export */ const card = (DealCard);
;// ./src/Components/Organisms/Dashboard/Deals/table-columns.tsx
function TableComponent(props){const{tableData,onEditIconClick,reloadTableData,tableLoading}=props;return/*#__PURE__*/(0,jsx_runtime.jsx)("div",{style:{width:"100%",display:"flex"},children:tableLoading?/*#__PURE__*/(0,jsx_runtime.jsx)(spin/* default */.A,{size:"large",style:{margin:"auto"}}):/*#__PURE__*/(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(tableData===null||tableData===void 0?void 0:tableData.length)>0?/*#__PURE__*/(0,jsx_runtime.jsx)("div",{className:styles_module.cards,children:tableData.map(deal=>/*#__PURE__*/(0,jsx_runtime.jsx)(card,{data:deal,reloadTableData:reloadTableData,onEditIconClick:onEditIconClick},"deals-".concat(deal.id)))}):/*#__PURE__*/(0,jsx_runtime.jsx)(empty/* default */.A,{description:"No deals found",style:{margin:"auto"}})})});}
// EXTERNAL MODULE: ./node_modules/react-redux/es/index.js + 21 modules
var es = __webpack_require__(98341);
;// ./src/Modules/Properties/permissions.ts
let PropertyPermissionsEnum=/*#__PURE__*/function(PropertyPermissionsEnum){PropertyPermissionsEnum["CREATE"]="createProperty";PropertyPermissionsEnum["UPDATE"]="updateProperty";PropertyPermissionsEnum["DELETE"]="deleteProperty";PropertyPermissionsEnum["READ"]="readProperty";PropertyPermissionsEnum["READ_COMPLETE_ORGANIZATION_PROPERTY"]="readCompleteOrganizationProperty";PropertyPermissionsEnum["READ_LOGS"]="readPropertyLogs";PropertyPermissionsEnum["DELETE_IMAGES"]="deleteImages";PropertyPermissionsEnum["DELETE_FILES"]="deleteFiles";PropertyPermissionsEnum["VERIFY_DOCUMENT"]="verifyDocument";PropertyPermissionsEnum["READ_PROPERTY_DOCUMENT"]="readPropertyDocument";PropertyPermissionsEnum["CHANGE_STATUS"]="changePropertyStatus";PropertyPermissionsEnum["PUBLISH_PROPERTY"]="publishProperty";PropertyPermissionsEnum["UNPUBLISH_PROPERTY"]="unpublishProperty";PropertyPermissionsEnum["EXPORT_ADS_REPORT"]="exportPropertyAdsReport";PropertyPermissionsEnum["VERIFY_TITLE_DEED"]="verifyPropertyTitleDeed";PropertyPermissionsEnum["UPDATE_SEO"]="updatePropertySEO";PropertyPermissionsEnum["UPDATE_ASSURED"]="updateAssuredProperty";PropertyPermissionsEnum["ASSIGN_PROPERTY"]="assignProperty";PropertyPermissionsEnum["REJECT_PROPERTY"]="rejectProperty";return PropertyPermissionsEnum;}({});let PropertyDealPermissionsEnum=/*#__PURE__*/function(PropertyDealPermissionsEnum){PropertyDealPermissionsEnum["CREATE"]="createPropertyDeals";PropertyDealPermissionsEnum["UPDATE"]="updatePropertyDeals";PropertyDealPermissionsEnum["DELETE"]="deletePropertyDeals";PropertyDealPermissionsEnum["READ"]="readPropertyDeals";return PropertyDealPermissionsEnum;}({});
// EXTERNAL MODULE: ./node_modules/antd/es/form/index.js + 18 modules
var es_form = __webpack_require__(10678);
// EXTERNAL MODULE: ./node_modules/antd/es/upload/index.js + 19 modules
var es_upload = __webpack_require__(28013);
// EXTERNAL MODULE: ./node_modules/antd/es/progress/index.js + 10 modules
var progress = __webpack_require__(37781);
// EXTERNAL MODULE: ./node_modules/antd/es/select/index.js + 30 modules
var es_select = __webpack_require__(97554);
// EXTERNAL MODULE: ./node_modules/antd/es/skeleton/index.js + 11 modules
var skeleton = __webpack_require__(46005);
// EXTERNAL MODULE: ./src/Components/Organisms/Common/styles.module.scss
var Common_styles_module = __webpack_require__(96019);
// EXTERNAL MODULE: ./src/Components/Organisms/Skeletons/index.tsx
var Skeletons = __webpack_require__(70619);
// EXTERNAL MODULE: ./src/Components/Atoms/ServerErrorHandler/index.tsx
var ServerErrorHandler = __webpack_require__(13321);
// EXTERNAL MODULE: ./src/helpers/error-handler.ts
var error_handler = __webpack_require__(38266);
// EXTERNAL MODULE: ./src/helpers/useDebounce.ts
var useDebounce = __webpack_require__(28173);
;// ./src/Components/Organisms/Dashboard/Deals/modal/index.tsx
const DealsModal=props=>{var _properties$data;const{openModal,onCancel,type,reloadTableData,record,tabKey,permissions:{createPropertyDeals,updatePropertyDeals}}=props;const[form]=es_form/* default */.A.useForm();const[fileList,setFileList]=(0,react.useState)([]);const[upload,setUpload]=(0,react.useState)({status:"normal",progress:0});const[showPreview,setShowPreview]=(0,react.useState)(false);const[publishType,setPublishType]=(0,react.useState)('draft');const[buttonLoading,setButtonLoading]=(0,react.useState)({publish:false,draft:false});const[uploadedData,setUploadedData]=(0,react.useState)();const[properties,setProperties]=(0,react.useState)({data:[],loading:false});const[searchTerm,setSearchTerm]=(0,react.useState)("");const debouncedSearchTerm=(0,useDebounce/* useDebounce */.d)(searchTerm,500);// property deals module
const module=(0,react.useMemo)(()=>new Properties/* PropertyDealsModule */.h(),[]);// properties module
const propertiesModule=(0,react.useMemo)(()=>new Properties/* PropertiesModule */.G(),[]);const[recordData,setRecordData]=(0,react.useState)();const handleErrors=err=>{const error=(0,error_handler/* errorHandler */.r)(err);if(typeof error.message=="string"){setRecordData((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},recordData),{},{error:error.message}));}else{let errData=(0,ServerErrorHandler/* HandleServerErrors */.p)(error.message,[]);form.setFields(errData);setRecordData((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},recordData),{},{error:""}));}};const handleAlertClose=()=>setRecordData((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},recordData),{},{error:""}));// Get the locations data from the api when the user searches for a location
const onPropertySearch=(0,react.useCallback)(()=>{if(debouncedSearchTerm){propertiesModule.getAllRecords({title:debouncedSearchTerm}).then(res=>{setProperties(prev=>{const data=res.data.data;// if the data is already present in the state, then don't add it again
const filteredData=data.filter(item=>{return!prev.data.some(prevItem=>prevItem.id===item.id);});return (0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},prev),{},{data:[...prev.data,...filteredData],loading:false});});}).catch(err=>{message/* default */.Ay.error(err.response.data.message||"Something went wrong while fetching the properties");setProperties(prev=>(0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},prev),{},{loading:false}));});}},[debouncedSearchTerm]);(0,react.useEffect)(()=>{onPropertySearch();},[onPropertySearch]);// Get data for the selected record from the api and set it in the form
const getPropertyById=(0,react.useCallback)(()=>{if(record.propertyId){propertiesModule.getRecordById(record.propertyId).then(res=>{var _res$data;const property=res===null||res===void 0?void 0:(_res$data=res.data)===null||_res$data===void 0?void 0:_res$data.data;setProperties(prev=>{var _prev$data;// if the data is already present in the state, then don't add it again
const filteredData=(_prev$data=prev.data)===null||_prev$data===void 0?void 0:_prev$data.filter(item=>{return item.id!==property.id;});// add the new data to the existing data
return (0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},prev),{},{data:[property,...filteredData],loading:false});});form.setFieldsValue({propertyId:property.id});}).catch(err=>{message/* default */.Ay.error(err.response.data.message||"Something went wrong");});}else{form.setFieldsValue({propertyId:undefined});}},[record.id,form]);// State to disable submit button
const isButtonDisabled=(0,react.useMemo)(()=>{if(type==="new"&&!uploadedData)return true;if(type==="edit"&&!record)return true;return false;},[type,uploadedData,record]);const handleUploadChange=info=>{if(createPropertyDeals===true){let fileList=[...info.fileList];fileList=fileList.slice(-1);// limit file count to 1
fileList=fileList.map(file=>{if(file.response){// create object URL for uploaded file
file.url=URL.createObjectURL(file.originFileObj);}return file;});setFileList(fileList);}else{message/* default */.Ay.error("You don't have permission to create deals, please contact your admin");}};const uploadMedia=async options=>{if(createPropertyDeals===true){const{onSuccess,onError,file}=options;const fmData=new FormData();const config={headers:{"content-type":"multipart/form-data"}};fmData.append("media",file);setUpload({status:"active",progress:0});const onUploadProgress=progressEvent=>{const{loaded,total}=progressEvent;let percent=0;if(total!==null&&total!==undefined){percent=Math.floor(loaded*100/total);}setUpload({status:"active",progress:percent});};try{var _res$data2;// after 2 seconds, show the preview
setTimeout(()=>{if(upload.status!=="exception"){setShowPreview(true);}},2000);const res=await axiosInstance/* default */.A.post("property-deals",fmData,(0,objectSpread2/* default */.A)({onUploadProgress},config));setUploadedData((_res$data2=res.data)===null||_res$data2===void 0?void 0:_res$data2.data);onSuccess("ok");setUpload({status:"success",progress:100});setRecordData((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},recordData),{},{error:""}));}catch(err){onError({err});handleErrors(err);setUpload({status:"exception",progress:0});setShowPreview(false);}}else{message/* default */.Ay.error("You don't have permission to create deals, please contact your admin");}};const onFinish=formValues=>{switch(type){case"new":{if(createPropertyDeals===true){const finalValues=(0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},formValues),{},{isPublished:publishType==="draft"?false:true});const recordId=uploadedData===null||uploadedData===void 0?void 0:uploadedData.id;setButtonLoading((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},buttonLoading),{},{[publishType]:true}));module.updateRecord(finalValues,recordId).then(res=>{if(res.data&&res.data.data){message/* default */.Ay.success("Deal created successfully");reloadTableData();onCancel();}else{message/* default */.Ay.error("Error creating deal");}}).catch(err=>{setButtonLoading((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},buttonLoading),{},{[publishType]:false}));handleErrors(err);});}else{message/* default */.Ay.error("You don't have permission to create deals, please contact your admin");}break;}case"edit":{if(updatePropertyDeals===true){const finalValues=(0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},formValues),{},{isPublished:publishType==="draft"?false:true});setButtonLoading((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},buttonLoading),{},{[publishType]:true}));module.updateRecord(finalValues,record.id).then(res=>{if(res.data&&res.data.data){message/* default */.Ay.success("Deal updated successfully");reloadTableData();onCancel();}else{message/* default */.Ay.error("Error updating deal");}}).catch(err=>{setButtonLoading((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},buttonLoading),{},{[publishType]:false}));handleErrors(err);});}else{message/* default */.Ay.error("You don't have permission to update deals, please contact your admin");}break;}}};// Get text for the action button
const ActionText=(0,react.useMemo)(()=>{let text="";if(type==="new"){text="Publish";}else if(type==="edit"&&tabKey==="expired"){text="Repost";}else{text="Update";}return text;},[type]);(0,react.useEffect)(()=>{if(record&&type==="edit"){form.setFieldsValue(record);// fetch property by id
getPropertyById();}else{form.resetFields();}},[record,form,type,getPropertyById]);return/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* CustomModal */.jo,{visible:openModal,closable:true,onCancel:onCancel,titleText:type==="edit"?"Edit Deal":"Add Deal",showFooter:false,children:recordData!==null&&recordData!==void 0&&recordData.loading?/*#__PURE__*/(0,jsx_runtime.jsx)(Skeletons/* default */.A,{items:5,fullWidth:true}):/*#__PURE__*/(0,jsx_runtime.jsxs)(es_form/* default */.A,{className:Common_styles_module/* default */.A.form,onFinish:onFinish,form:form,children:[(recordData===null||recordData===void 0?void 0:recordData.error)&&/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* CustomErrorAlert */.WZ,{description:recordData===null||recordData===void 0?void 0:recordData.error,onClose:handleAlertClose,isClosable:true}),(type==="new"&&showPreview===false||upload.status==="exception")&&/*#__PURE__*/(0,jsx_runtime.jsxs)(es_upload/* default */.A.Dragger,{accept:"image/*,video/*",className:styles_module.dragger,name:"file",customRequest:uploadMedia,onChange:info=>handleUploadChange(info),disabled:showPreview&&upload.status==="exception"?true:false,fileList:fileList// Prevents upload if createPropertyDeals permissions is false
,beforeUpload:()=>createPropertyDeals===true?true:false,children:[/*#__PURE__*/(0,jsx_runtime.jsx)("p",{className:"ant-upload-hint",children:"Drag media here or click to upload media"}),/*#__PURE__*/(0,jsx_runtime.jsxs)("div",{className:styles_module.numberOfUploads,children:[/*#__PURE__*/(0,jsx_runtime.jsx)("p",{children:"".concat(fileList.length,"/1")}),/*#__PURE__*/(0,jsx_runtime.jsxs)("ul",{style:{paddingLeft:"15px",marginBottom:0},children:[/*#__PURE__*/(0,jsx_runtime.jsx)("li",{children:"Only *.jpeg, *.jpg, *.png, *.mp4, *.mov, *.3gp files are allowed"}),/*#__PURE__*/(0,jsx_runtime.jsx)("li",{children:"Maximum image file size is 5MB"}),/*#__PURE__*/(0,jsx_runtime.jsx)("li",{children:"Maximum video file size is 100MB"}),/*#__PURE__*/(0,jsx_runtime.jsx)("li",{children:"Maximum video duration is 1 minute. Longer videos will be trimmed"})]})]})]}),upload.progress>0&&/*#__PURE__*/(0,jsx_runtime.jsx)(progress/* default */.A,{percent:upload.progress,status:upload.status,showInfo:false,className:styles_module.uploadProgress}),upload.status!=="exception"&&/*#__PURE__*/(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[/*#__PURE__*/(0,jsx_runtime.jsxs)("div",{className:styles_module.mediaPreviewContainer,children:[showPreview&&type==="new"&&/*#__PURE__*/(0,jsx_runtime.jsx)("div",{className:styles_module.mediaPreview,children:fileList.map(file=>/*#__PURE__*/(0,jsx_runtime.jsx)("div",{className:styles_module.mediaItem,children:file.type.includes("image")?/*#__PURE__*/(0,jsx_runtime.jsx)("img",{src:file.url,alt:"preview",width:200,height:250,style:{objectFit:"cover"}}):/*#__PURE__*/(0,jsx_runtime.jsx)("video",{src:file.url,controls:true,width:200,height:250})},file.uid))}),(!showPreview&&type==="edit"||showPreview&&type==="new")&&/*#__PURE__*/(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:/*#__PURE__*/(0,jsx_runtime.jsxs)("div",{className:styles_module.mediaDetails,children:[/*#__PURE__*/(0,jsx_runtime.jsx)("div",{children:/*#__PURE__*/(0,jsx_runtime.jsxs)(es_form/* default */.A.Item,{name:"propertyId",rules:[{required:publishType==="draft"?false:true,message:"Please select a property"}],style:{marginTop:10},children:[/*#__PURE__*/(0,jsx_runtime.jsxs)("label",{className:"font-size-sm",children:["Property  ",publishType==="publish"&&/*#__PURE__*/(0,jsx_runtime.jsx)("span",{className:"color-red-yp",children:"*"})]}),/*#__PURE__*/(0,jsx_runtime.jsx)(es_select/* default */.A,{allowClear:true,style:{width:"100%"},defaultValue:record===null||record===void 0?void 0:record.propertyId,placeholder:"Search for a property",className:"selectAntdCustom",onChange:value=>form.setFieldsValue({propertyId:value}),showSearch:true,onSearch:value=>setSearchTerm(value),optionFilterProp:"label",options:properties===null||properties===void 0?void 0:(_properties$data=properties.data)===null||_properties$data===void 0?void 0:_properties$data.map(item=>{return{label:item.localization[0].title,value:item.id};}),notFoundContent:(properties===null||properties===void 0?void 0:properties.loading)===true?/*#__PURE__*/(0,jsx_runtime.jsx)(skeleton/* default */.A,{}):/*#__PURE__*/(0,jsx_runtime.jsx)(empty/* default */.A,{image:"https://gw.alipayobjects.com/zos/antfincdn/ZHrcdLPrvN/empty.svg",imageStyle:{height:100},description:/*#__PURE__*/(0,jsx_runtime.jsx)("span",{children:"No data found, Please search for a property"})})})]})}),/*#__PURE__*/(0,jsx_runtime.jsx)("div",{children:/*#__PURE__*/(0,jsx_runtime.jsx)(es_form/* default */.A.Item,{name:"caption",children:/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* CustomInput */.wi,{type:"textArea",label:"Caption",placeHolder:"Caption",size:"w100",rows:3,autoSize:{minRows:3}})})}),/*#__PURE__*/(0,jsx_runtime.jsxs)("div",{children:[/*#__PURE__*/(0,jsx_runtime.jsx)(es_form/* default */.A.Item,{name:"discountType",children:/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* CustomSelect */.Ae,{label:"Discount Type",options:[{value:"flat",label:"Flat"},{value:"percentage",label:"Percentage"}]})}),/*#__PURE__*/(0,jsx_runtime.jsx)(es_form/* default */.A.Item,{name:"value",children:/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* CustomInput */.wi,{label:"Discount Value",type:"text",placeHolder:"Discount Value",size:"w100"})})]})]})})]}),(!showPreview&&type==="edit"||showPreview&&type==="new")&&/*#__PURE__*/(0,jsx_runtime.jsxs)("div",{className:Common_styles_module/* default */.A.footer,children:[(type==="new"||type==="edit"&&tabKey==="draft")&&/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* CustomButton */.Sv,{type:"outlined",size:"normal",fontSize:"sm",htmlType:"submit",loading:buttonLoading.draft,disabled:isButtonDisabled,onClick:()=>setPublishType("draft"),children:"Save as draft"}),/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* CustomButton */.Sv,{type:"primary",size:"normal",fontSize:"sm",htmlType:"submit",loading:buttonLoading.publish,disabled:isButtonDisabled,onClick:()=>setPublishType("publish"),children:ActionText})]})]})]})});};
// EXTERNAL MODULE: ./node_modules/antd/es/tabs/index.js + 22 modules
var tabs = __webpack_require__(92555);
// EXTERNAL MODULE: ./src/helpers/common.ts
var common = __webpack_require__(88132);
;// ./src/Components/Organisms/Dashboard/Deals/types.ts
// types
let TabKeysEnum=/*#__PURE__*/function(TabKeysEnum){TabKeysEnum["active"]="active";TabKeysEnum["draft"]="draft";TabKeysEnum["expired"]="expired";return TabKeysEnum;}({});
;// ./src/Components/Organisms/Dashboard/Deals/index.tsx
// import { useSearchParams } from "react-router-dom";
const breadCrumbsData=[{text:"Home",isLink:true,path:"/"},{isLink:false,text:"Deals"}];function PropertyDeals(){// available permissions for the properties page
const permissionSlug=(0,common/* getPermissionSlugs */.AH)(PropertyDealPermissionsEnum);const{userPermissions}=(0,es/* useSelector */.d4)(state=>state.usersReducer);const permissions=userPermissions;const[modalType,setModalType]=(0,react.useState)({type:"new",record:{},openModal:false});// property deals module
const module=(0,react.useMemo)(()=>new Properties/* PropertyDealsModule */.h(),[]);const[activeTab,setActiveTab]=(0,react.useState)({key:"active",label:"Active"});//const [searchParams] = useSearchParams();
// const propertyId = searchParams.get("propertyId");
const[moduleData,setModuleData]=(0,react.useState)({loading:false,error:{},data:[]});const onCancelClick=()=>{setModalType((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},modalType),{},{openModal:!modalType.openModal,type:"new"}));};const onEditIconClick=record=>{setModalType((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},modalType),{},{type:"edit",record:record,openModal:true}));};const reloadTableData=(0,react.useCallback)(query=>{setModuleData((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},moduleData),{},{loading:true}));module.getAllRecords(query).then(response=>{var _response$data;setModuleData((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},moduleData),{},{loading:false,data:(_response$data=response.data)===null||_response$data===void 0?void 0:_response$data.data}));}).catch(error=>{setModuleData((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},moduleData),{},{loading:false,error:error}));});},[]);const onTabChange=(0,react.useCallback)(()=>{if(activeTab.key){let query={};switch(activeTab.key){case"active":{query={isPublished:true,isExpired:false};break;}case"draft":{query={isPublished:false};break;}case"expired":{query={isPublished:true,isExpired:true};break;}}reloadTableData(query);}},[activeTab.key]);(0,react.useEffect)(()=>{onTabChange();},[onTabChange]);// useEffect(() => {
// 	if (propertyId) {
// 		setcurrentEditType({
// 			...currentEditType,
// 			openModal: true,
// 		});
// 	}
// }, [propertyId]);
return/*#__PURE__*/(0,jsx_runtime.jsx)(Layout/* default */.A,{permissionSlug:permissionSlug,children:/*#__PURE__*/(0,jsx_runtime.jsxs)("div",{children:[/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* PageHeader */.zY,{heading:"Deals",buttonText:"Add Deal",onButtonClick:onCancelClick,breadCrumbData:breadCrumbsData,showAdd:permissions.createPropertyDeals===true?true:false}),/*#__PURE__*/(0,jsx_runtime.jsx)(tabs/* default */.A,{type:"card",onTabClick:key=>{setActiveTab({key:key,label:(0,common/* capitalize */.ZH)(key)});},children:Object.keys(TabKeysEnum).map(key=>/*#__PURE__*/(0,jsx_runtime.jsx)(tabs/* default */.A.TabPane,{tab:(0,common/* capitalize */.ZH)(key),children:/*#__PURE__*/(0,jsx_runtime.jsx)(TableComponent,{tableData:moduleData.data,tableLoading:moduleData.loading,onEditIconClick:onEditIconClick,reloadTableData:reloadTableData})},key))}),modalType.openModal&&/*#__PURE__*/(0,jsx_runtime.jsx)(DealsModal,{type:modalType.type,reloadTableData:reloadTableData,onCancel:onCancelClick,openModal:modalType.openModal,permissions:permissions,record:modalType.record,tabKey:activeTab.key})]})});}/* harmony default export */ const Deals = (PropertyDeals);

/***/ }),

/***/ 40743:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   G: () => (/* binding */ PropertiesModule),
/* harmony export */   h: () => (/* binding */ PropertyDealsModule)
/* harmony export */ });
/* harmony import */ var _services_axiosInstance__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(83365);
/* harmony import */ var _Common_config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(21073);
/** Properties Module */class PropertiesModule{constructor(){this.endPoint="property";this.getAllRecords=queryData=>{return _services_axiosInstance__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .A.get(this.endPoint,{params:queryData});};this.getRecordById=id=>{return _services_axiosInstance__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .A.get("".concat(this.endPoint,"/findOneById/").concat(id));};/**
	 *  Get Record By Slug 
	 * @param slug - slug of the property
	 */this.getRecordBySlug=slug=>{return _services_axiosInstance__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .A.get("".concat(this.endPoint,"/").concat(slug));};this.deleteRecord=id=>{return _services_axiosInstance__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .A.delete("".concat(this.endPoint,"/").concat(id));};this.createRecord=data=>{return _services_axiosInstance__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .A.post(this.endPoint+"/",data,{headers:_Common_config__WEBPACK_IMPORTED_MODULE_1__/* .FormDataHeader */ .Y});};this.updateRecord=(data,id)=>{return _services_axiosInstance__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .A.patch("".concat(this.endPoint,"/update-property/").concat(id),data,{headers:_Common_config__WEBPACK_IMPORTED_MODULE_1__/* .FormDataHeader */ .Y});};// Publish Property
this.publishRecord=data=>{return _services_axiosInstance__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .A.patch("".concat(this.endPoint,"/publish-property"),data);};// Unpublish Property by Id
this.unpublishRecord=(data,id)=>{return _services_axiosInstance__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .A.patch("".concat(this.endPoint,"/unpublish-property/").concat(id),data);};/**Verify Title Deed */this.verifyTitleDeed=(data,id)=>{return _services_axiosInstance__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .A.patch("".concat(this.endPoint,"/verifyTitleDeed/").concat(id),data);};/**
	 * Verify Property Documents
	 * @param data - data to be updated
	 * @param id - id of the document
	 */this.verifyPropertyDocuments=(data,id)=>{return _services_axiosInstance__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .A.patch("".concat(this.endPoint,"/verify-document/").concat(id),data);};/** Get Property Logs */this.getLogs=id=>{return _services_axiosInstance__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .A.get("".concat(this.endPoint,"/logs/").concat(id));};/** Auto Renew
	 * @param id - id of the transaction
	 */this.autoRenew=(autoRenew,id)=>{return _services_axiosInstance__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .A.patch("".concat(this.endPoint,"/autoRenewListing/").concat(id),{autoRenew});};/**
	 * Update SEO
	 * @param data - data to be updated
	 * @param id - id of the property
	 */this.updateSEO=(data,id)=>{return _services_axiosInstance__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .A.post("".concat(this.endPoint,"/update-seo/").concat(id),data);};/**
	 * Update dynamic SEO
	 * @param data - data to be updated
	 * @param id - id of the property
	 */this.updateDynamicSEO=(data,id)=>{return _services_axiosInstance__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .A.post("".concat(this.endPoint,"/update-dynamic-seo/").concat(id),data);};/**
	 * Update Assured Property
	 * @param data - data to be updated
	 * @param id - id of the property
	 * */this.updateAssuredProperty=(data,id)=>{return _services_axiosInstance__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .A.patch("".concat(this.endPoint,"/updateAssured/").concat(id),data);};/**
	 * Update Images Order
	 * @param data - data to be updated
	 * @param id - id of the property
	 * */this.updateImagesOrder=(data,id)=>{return _services_axiosInstance__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .A.patch("".concat(this.endPoint,"/updateImagesOrder/").concat(id),data);};this.assignProperty=(data,id)=>{return _services_axiosInstance__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .A.patch("".concat(this.endPoint,"/assignProperty/").concat(id),data);};/** Get All Property Documents
	 * @param queryData - query params
	*/this.getAllPropertyDocuments=queryData=>{return _services_axiosInstance__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .A.get("".concat(this.endPoint,"/property-documents"),{params:queryData});};/** Get Property Documents By Id 
	 * @param id - id of the property
	*/this.getPropertyDocumentsById=id=>{return _services_axiosInstance__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .A.get("".concat(this.endPoint,"/get-property-documents/").concat(id));};/**
	 * Reject Property
	 * @param data.message - reason for rejecting the property
	 * @param id - id of the property
	 */this.rejectProperty=(data,id)=>{return _services_axiosInstance__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .A.post("".concat(this.endPoint,"/rejectProperty/").concat(id),data);};/** Manual Action */this.manualAction=(data,id)=>{return _services_axiosInstance__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .A.patch("".concat(this.endPoint,"/manualAction/").concat(id),data);};}}/** Property Deals Module */class PropertyDealsModule{constructor(){this.endPoint="property-deals";/**
	 * Get All Records
	 * @param queryData - query params
	 */this.getAllRecords=queryData=>{return _services_axiosInstance__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .A.get(this.endPoint,{params:queryData});};/** Get Property deal using property id
	 * @param id - property id
	 */this.getRecordById=id=>{return _services_axiosInstance__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .A.get("".concat(this.endPoint,"/findPropertyDeals/").concat(id));};/** Find Published Deals
	 * @param queryData - query params
	 * @param queryData.page - page number
	 * @param queryData.perPage - number of records per page
	 */this.getPublished=queryData=>{return _services_axiosInstance__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .A.get("".concat(this.endPoint,"/find-published"),{params:queryData});};/** Find Published Property Deals
	 * @param queryData - query params
	 * @param queryData.perPage - number of records per page
	 * @param queryData.page - page number
	 */this.getPublishedDeals=queryData=>{return _services_axiosInstance__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .A.get("".concat(this.endPoint,"/find-published-deals"),{params:queryData});};/** Create Property Deal
	 * @param data - data to create property deal
	 */this.createRecord=data=>{return _services_axiosInstance__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .A.post(this.endPoint+"/",data,{headers:_Common_config__WEBPACK_IMPORTED_MODULE_1__/* .FormDataHeader */ .Y});};/** Update Property Deal
	 * @param data - data to be updated
	 * @param id - id of the property deal
	 */this.updateRecord=(data,id)=>{return _services_axiosInstance__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .A.patch("".concat(this.endPoint,"/").concat(id),data,{headers:_Common_config__WEBPACK_IMPORTED_MODULE_1__/* .FormDataHeader */ .Y});};/** Delete Property Deal
	 * @param id - id of the property deal
	 * */this.deleteRecord=id=>{return _services_axiosInstance__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .A.delete("".concat(this.endPoint,"/").concat(id));};}}

/***/ })

}]);