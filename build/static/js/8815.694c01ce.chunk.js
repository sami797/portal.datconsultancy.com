"use strict";
(self["webpackChunkdat_projects"] = self["webpackChunkdat_projects"] || []).push([[8815],{

/***/ 58815:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__);

// EXPORTS
__webpack_require__.d(__webpack_exports__, {
  "default": () => (/* binding */ CreditsRate)
});

// EXTERNAL MODULE: ./node_modules/@babel/runtime/helpers/esm/objectSpread2.js
var objectSpread2 = __webpack_require__(89379);
// EXTERNAL MODULE: ./node_modules/react/index.js
var react = __webpack_require__(9950);
// EXTERNAL MODULE: ./src/Components/Templates/SiteSettings/index.tsx
var SiteSettings = __webpack_require__(16181);
// EXTERNAL MODULE: ./node_modules/antd/es/form/index.js + 18 modules
var es_form = __webpack_require__(10678);
// EXTERNAL MODULE: ./node_modules/antd/es/message/index.js + 1 modules
var message = __webpack_require__(92759);
// EXTERNAL MODULE: ./src/Components/Atoms/index.tsx + 12 modules
var Atoms = __webpack_require__(9394);
// EXTERNAL MODULE: ./src/Components/Organisms/SiteSettings/Common/styles.module.scss
var styles_module = __webpack_require__(41394);
// EXTERNAL MODULE: ./src/Components/Organisms/Skeletons/index.tsx
var Skeletons = __webpack_require__(70619);
// EXTERNAL MODULE: ./src/Components/Atoms/ServerErrorHandler/index.tsx
var ServerErrorHandler = __webpack_require__(13321);
// EXTERNAL MODULE: ./src/helpers/error-handler.ts
var error_handler = __webpack_require__(38266);
// EXTERNAL MODULE: ./src/services/axiosInstance.ts
var axiosInstance = __webpack_require__(83365);
;// ./src/Modules/CreditsRate/index.ts
class CreditsRateModule{constructor(){this.endPoint="credits-rate";this.getAllRecords=query=>{return axiosInstance/* default */.A.get(this.endPoint,{params:query});};this.getRecordById=id=>{return axiosInstance/* default */.A.get("".concat(this.endPoint,"/").concat(id));};this.createRecord=data=>{return axiosInstance/* default */.A.post(this.endPoint+"/",data);};}}
// EXTERNAL MODULE: ./src/Modules/Country/index.ts
var Country = __webpack_require__(83584);
// EXTERNAL MODULE: ./node_modules/react/jsx-runtime.js
var jsx_runtime = __webpack_require__(44414);
;// ./src/Components/Organisms/SiteSettings/CreditsRate/modal.tsx
const CreditsRateModal=props=>{const{openModal,onCancel,type,reloadTableData,permissions:{createCreditsRate}}=props;const[form]=es_form/* default */.A.useForm();// Credits Module
const module=(0,react.useMemo)(()=>new CreditsRateModule(),[]);const countryModule=(0,react.useMemo)(()=>new Country/* CountryModule */.j(),[]);const[recordData,setRecordData]=(0,react.useState)();const[countries,setCountries]=(0,react.useState)([]);const handleErrors=err=>{const error=(0,error_handler/* errorHandler */.r)(err);if(typeof error.message=="string"){setRecordData((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},recordData),{},{error:error.message}));}else{let errData=(0,ServerErrorHandler/* HandleServerErrors */.p)(error.message,[]);form.setFields(errData);setRecordData((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},recordData),{},{error:""}));}};const handleAlertClose=()=>{setRecordData((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},recordData),{},{error:""}));};const getCountryList=(0,react.useCallback)(()=>{countryModule.getAllRecords().then(res=>{var _res$data;if(res!==null&&res!==void 0&&(_res$data=res.data)!==null&&_res$data!==void 0&&_res$data.data){setCountries(res.data.data);}});},[countryModule]);(0,react.useEffect)(()=>{if(type==="new"){getCountryList();}},[type,getCountryList]);(0,react.useEffect)(()=>{if(type==="edit"){setRecordData({loading:true});}else{form.resetFields();}},[openModal,type,form]);const onFinish=formValues=>{setRecordData((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},recordData),{},{buttonLoading:true}));// convert the country id in formValues to a number
formValues.countryId=Number(formValues.countryId);if(type==="new"){if(createCreditsRate===true){module.createRecord(formValues).then(res=>{reloadTableData();onCancel();setRecordData(prev=>(0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},prev),{},{buttonLoading:false}));}).catch(err=>{handleErrors(err);setRecordData(prev=>(0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},prev),{},{buttonLoading:false}));});}else{setRecordData(prev=>(0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},prev),{},{buttonLoading:false}));message/* default */.Ay.error("You do not have permission to create a new credit rate");}}else{setRecordData(prev=>(0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},prev),{},{buttonLoading:false}));}};return/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* CustomModal */.jo,{visible:openModal,closable:true,onCancel:onCancel,titleText:type==="edit"?"Edit Credit Rate":"Add New Credit Rate",showFooter:false,children:recordData!==null&&recordData!==void 0&&recordData.loading?/*#__PURE__*/(0,jsx_runtime.jsx)(Skeletons/* default */.A,{items:10}):/*#__PURE__*/(0,jsx_runtime.jsxs)(es_form/* default */.A,{className:styles_module/* default */.A.form,onFinish:onFinish,form:form,children:[(recordData===null||recordData===void 0?void 0:recordData.error)&&/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* CustomErrorAlert */.WZ,{description:recordData===null||recordData===void 0?void 0:recordData.error,isClosable:true,onClose:handleAlertClose}),/*#__PURE__*/(0,jsx_runtime.jsxs)("div",{children:[/*#__PURE__*/(0,jsx_runtime.jsx)(es_form/* default */.A.Item,{name:"credits",rules:[{required:true,message:"Please add credits"}],children:/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* CustomInput */.wi,{size:"w100",label:"Credits",asterisk:true,type:"number"})}),/*#__PURE__*/(0,jsx_runtime.jsx)(es_form/* default */.A.Item,{name:"rate",rules:[{required:true,message:"Please add a rate"}],children:/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* CustomInput */.wi,{size:"w100",label:"Rate",asterisk:true,type:"number"})})]}),/*#__PURE__*/(0,jsx_runtime.jsx)("div",{children:/*#__PURE__*/(0,jsx_runtime.jsx)(es_form/* default */.A.Item,{name:"countryId",rules:[{required:true,message:"Please select a country"}],children:/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* CustomSelect */.Ae,{label:"Country",options:countries===null||countries===void 0?void 0:countries.map(country=>({label:country.name,value:country.id}))})})}),/*#__PURE__*/(0,jsx_runtime.jsxs)("div",{className:styles_module/* default */.A.footer,children:[/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* CustomButton */.Sv,{size:"normal",fontSize:"sm",onClick:onCancel,type:"plain",children:"Cancel"}),/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* CustomButton */.Sv,{type:"primary",size:"normal",fontSize:"sm",htmlType:"submit",loading:recordData===null||recordData===void 0?void 0:recordData.buttonLoading,children:"Submit"})]})]})});};
// EXTERNAL MODULE: ./node_modules/antd/es/tag/index.js + 1 modules
var tag = __webpack_require__(12916);
// EXTERNAL MODULE: ./node_modules/antd/es/table/index.js + 96 modules
var table = __webpack_require__(41821);
// EXTERNAL MODULE: ./src/Components/Atoms/Headings/index.tsx
var Headings = __webpack_require__(35751);
// EXTERNAL MODULE: ./src/helpers/dateHandler.ts
var dateHandler = __webpack_require__(98933);
;// ./src/Components/Organisms/SiteSettings/CreditsRate/table-columns.tsx
function TableComponent(props){const{tableData,tableLoading}=props;const columns=[{title:"S.No",dataIndex:"index",key:"index",render:(text,record,index)=>index+1,width:"60px"},{title:"Credits",dataIndex:"credits",key:"credits",render:credits=>/*#__PURE__*/(0,jsx_runtime.jsx)(Headings/* default */.A,{color:"dark-main",size:"sm",weight:"bold",children:credits})},{title:"Rate",dataIndex:"rate",key:"rate",render:(rate,record)=>/*#__PURE__*/(0,jsx_runtime.jsx)(Headings/* default */.A,{color:"dark-main",size:"sm",weight:"bold",children:"".concat(record.currency.symbol," ").concat(rate.toFixed(2))})},{title:"Rate Per Credit",dataIndex:"ratePerCredit",key:"ratePerCredit",render:ratePerCredit=>/*#__PURE__*/(0,jsx_runtime.jsx)(Headings/* default */.A,{color:"dark-main",size:"sm",weight:"bold",children:ratePerCredit.toFixed(4)})},{title:"Country",dataIndex:"country",key:"country",render:country=>/*#__PURE__*/(0,jsx_runtime.jsx)(Headings/* default */.A,{color:"dark-main",size:"sm",weight:"bold",children:country.name})},{title:"Active",dataIndex:"isActive",key:"isActive",render:(isActive,record)=>/*#__PURE__*/(0,jsx_runtime.jsx)("div",{children:isActive===true?/*#__PURE__*/(0,jsx_runtime.jsx)(tag/* default */.A,{color:"#00A884",children:"Active"}):/*#__PURE__*/(0,jsx_runtime.jsx)(tag/* default */.A,{color:"#f50",children:"Inactive"})})},{title:"Date Added",dataIndex:"addedDate",key:"addedDate",render:addedDate=>{return/*#__PURE__*/(0,jsx_runtime.jsx)(Headings/* default */.A,{color:"dark-sub",size:"sm",children:(0,dateHandler/* convertDate */.ic)(addedDate,"dd M,yy-t")});},width:"200px"}];return/*#__PURE__*/(0,jsx_runtime.jsx)("div",{className:styles_module/* default */.A.antdTableWrapper,children:/*#__PURE__*/(0,jsx_runtime.jsx)(table/* default */.A,{sticky:true,dataSource:tableData,columns:columns,pagination:false,loading:tableLoading,rowKey:record=>"credits-rate-".concat(record.id)})});}
// EXTERNAL MODULE: ./src/helpers/commonEnums.ts
var commonEnums = __webpack_require__(2360);
// EXTERNAL MODULE: ./src/helpers/common.ts
var common = __webpack_require__(88132);
;// ./src/Modules/CreditsRate/permissions.ts
let CreditsRatePermissionsEnum=/*#__PURE__*/function(CreditsRatePermissionsEnum){CreditsRatePermissionsEnum["CREATE"]="createCreditsRate";CreditsRatePermissionsEnum["UPDATE"]="updateCreditsRate";CreditsRatePermissionsEnum["DELETE"]="deleteCreditsRate";CreditsRatePermissionsEnum["READ"]="readCreditsRate";return CreditsRatePermissionsEnum;}({});
// EXTERNAL MODULE: ./node_modules/react-redux/es/index.js + 21 modules
var es = __webpack_require__(98341);
// EXTERNAL MODULE: ./src/Components/Atoms/ErrorCodes/index.tsx + 1 modules
var ErrorCodes = __webpack_require__(36250);
;// ./src/Components/Organisms/SiteSettings/CreditsRate/index.tsx
const breadCrumbsData=[{text:"Home",isLink:true,path:"/"},{isLink:true,text:"Site Settings",path:"/siteSettings"},{isLink:false,text:"Credits Rate"}];function CreditsRateSettings(){var _moduleData$meta,_moduleData$meta2,_moduleData$meta3,_moduleData$meta4;// available permissions for this module
const permissionSlug=(0,common/* getPermissionSlugs */.AH)(CreditsRatePermissionsEnum);const{userPermissions}=(0,es/* useSelector */.d4)(state=>state.usersReducer);const permissions=userPermissions;const{readCreditsRate,createCreditsRate,updateCreditsRate}=permissions;const[currentEditType,setcurrentEditType]=(0,react.useState)({editType:"new",recordId:0,openModal:false});const module=new CreditsRateModule();const countryModule=(0,react.useMemo)(()=>new Country/* CountryModule */.j(),[]);const[moduleData,setModuleData]=(0,react.useState)({data:[]});const[countries,setCountries]=(0,react.useState)([]);const getCountryList=(0,react.useCallback)(()=>{countryModule.getAllRecords().then(res=>{if(res.data&&res.data.data){setCountries(res.data.data);}});},[countryModule]);const onCancelClick=()=>{if(createCreditsRate===false){message/* default */.Ay.error("You don't have permission to create new record");return;}setcurrentEditType((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},currentEditType),{},{openModal:!currentEditType.openModal,editType:"new"}));};const onEditIconClick=record=>{if(updateCreditsRate===false){message/* default */.Ay.error("You don't have permission to update record");return;}setcurrentEditType((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},currentEditType),{},{editType:"edit",recordId:record.id,openModal:true}));};const[selectedFilters,setSelectedFilters]=(0,react.useState)({dateRange:[""],countryId:0,rate:0,matchOperator:"",isActive:null});const[reset,setReset]=(0,react.useState)(false);const onSelected=event=>{const{name,value}=event===null||event===void 0?void 0:event.target;if(name==="rate"){const validRate=(0,common/* isNumber */.Et)(value);if(!validRate){message/* default */.Ay.error("Rate must be only numbers");return;}}// set the selected value in the state 
setSelectedFilters((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},selectedFilters),{},{[name]:value}));};const onReset=(0,react.useCallback)((name,value)=>{if(name){setReset(true);setSelectedFilters((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},selectedFilters),{},{[name]:value}));}},[selectedFilters]);const reloadTableData=(0,react.useCallback)(query=>{setModuleData((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},moduleData),{},{loading:true}));module.getAllRecords(query).then(res=>{setModuleData(res.data);}).catch(err=>{});},[module]);const onUpdate=(0,react.useCallback)(()=>{var _selectedFilters$date,_selectedFilters$date2;const fromDateString=((_selectedFilters$date=selectedFilters.dateRange)===null||_selectedFilters$date===void 0?void 0:_selectedFilters$date[0])||"";const toDateString=((_selectedFilters$date2=selectedFilters.dateRange)===null||_selectedFilters$date2===void 0?void 0:_selectedFilters$date2[1])||"";const fromDate=fromDateString?(0,dateHandler/* convertDate */.ic)(fromDateString,"yy-mm-dd"):undefined;const toDate=toDateString?(0,dateHandler/* convertDate */.ic)(toDateString,"yy-mm-dd"):undefined;const data={countryId:selectedFilters.countryId||undefined,rate:selectedFilters.rate||undefined,matchOperator:selectedFilters.matchOperator||undefined,isActive:selectedFilters.isActive||undefined,fromDate:fromDate,toDate:toDate};reloadTableData(data);},[selectedFilters]);const onPaginationChange=(0,react.useCallback)((page,pageSize)=>{var _selectedFilters$date3,_selectedFilters$date4;const fromDateString=((_selectedFilters$date3=selectedFilters.dateRange)===null||_selectedFilters$date3===void 0?void 0:_selectedFilters$date3[0])||"";const toDateString=((_selectedFilters$date4=selectedFilters.dateRange)===null||_selectedFilters$date4===void 0?void 0:_selectedFilters$date4[1])||"";const fromDate=fromDateString?(0,dateHandler/* convertDate */.ic)(fromDateString,"yy-mm-dd"):undefined;const toDate=toDateString?(0,dateHandler/* convertDate */.ic)(toDateString,"yy-mm-dd"):undefined;const params={page:page,perPage:pageSize,countryId:selectedFilters.countryId||undefined,rate:selectedFilters.rate||undefined,matchOperator:selectedFilters.matchOperator||undefined,isActive:selectedFilters.isActive||undefined,fromDate:fromDate,toDate:toDate};reloadTableData(params);},[selectedFilters]);(0,react.useEffect)(()=>{if(reset){onUpdate();}// after 2 seconds set reset clicked state to false
const timer=setTimeout(()=>{setReset(false);},2000);return()=>clearTimeout(timer);},[reset,selectedFilters,onUpdate]);(0,react.useEffect)(()=>{reloadTableData();getCountryList();},[]);return/*#__PURE__*/(0,jsx_runtime.jsxs)(SiteSettings["default"],{permissionSlug:permissionSlug,children:[/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* PageHeader */.zY,{heading:"Credits Rate",buttonText:"Add New Credits Rate",onButtonClick:onCancelClick,breadCrumbData:breadCrumbsData,showAdd:createCreditsRate===true?true:false,filters:readCreditsRate===true?/*#__PURE__*/(0,jsx_runtime.jsxs)("div",{children:[/*#__PURE__*/(0,jsx_runtime.jsx)("div",{children:/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* CustomFilter */.YH,{type:"datepicker",label:"Date",name:"dateRange",onChange:value=>{setSelectedFilters((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},selectedFilters),{},{dateRange:value}));},onReset:()=>onReset("dateRange",[]),onUpdate:onUpdate})}),/*#__PURE__*/(0,jsx_runtime.jsx)("div",{children:/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* CustomFilter */.YH,{type:"input",label:"Rate",name:"rate",value:(selectedFilters===null||selectedFilters===void 0?void 0:selectedFilters.rate)>0?String(selectedFilters===null||selectedFilters===void 0?void 0:selectedFilters.rate):"",onChange:onSelected,onReset:()=>onReset("rate",""),onUpdate:onUpdate})}),/*#__PURE__*/(0,jsx_runtime.jsx)("div",{children:/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* CustomFilter */.YH,{type:"radio",label:"Rate Operator",name:"matchOperator",options:Object.entries(commonEnums/* MatchOperator */.I).map(_ref=>{let[key,value]=_ref;return{label:(0,common/* capitalize */.ZH)(key),value:value};}),value:String(selectedFilters===null||selectedFilters===void 0?void 0:selectedFilters.matchOperator),onChange:onSelected,onReset:()=>onReset("matchOperator",""),onUpdate:onUpdate})}),/*#__PURE__*/(0,jsx_runtime.jsx)("div",{children:/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* CustomFilter */.YH,{type:"radio",label:"Status",name:"isActive",options:[{label:"Active",value:"true"},{label:"Inactive",value:"false"}],value:selectedFilters.isActive!==null?String(selectedFilters.isActive):"",onChange:onSelected,onReset:()=>onReset("isActive",""),onUpdate:onUpdate})}),/*#__PURE__*/(0,jsx_runtime.jsx)("div",{children:/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* CustomFilter */.YH,{type:"radio",label:"Country",name:"countryId",options:countries.map(country=>({label:country.name,value:"".concat(country.id)})),value:selectedFilters.countryId>0?String(selectedFilters===null||selectedFilters===void 0?void 0:selectedFilters.countryId):"",onChange:onSelected,onReset:()=>onReset("countryId",""),onUpdate:onUpdate})})]}):null}),readCreditsRate===true&&/*#__PURE__*/(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[/*#__PURE__*/(0,jsx_runtime.jsx)(TableComponent,{tableData:moduleData.data,tableLoading:moduleData.loading,onEditIconClick:onEditIconClick,reloadTableData:reloadTableData}),/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* Pagination */.dK,{total:moduleData===null||moduleData===void 0?void 0:(_moduleData$meta=moduleData.meta)===null||_moduleData$meta===void 0?void 0:_moduleData$meta.total,current:moduleData===null||moduleData===void 0?void 0:(_moduleData$meta2=moduleData.meta)===null||_moduleData$meta2===void 0?void 0:_moduleData$meta2.page,defaultPageSize:moduleData!==null&&moduleData!==void 0&&(_moduleData$meta3=moduleData.meta)!==null&&_moduleData$meta3!==void 0&&_moduleData$meta3.perPage?moduleData===null||moduleData===void 0?void 0:(_moduleData$meta4=moduleData.meta)===null||_moduleData$meta4===void 0?void 0:_moduleData$meta4.perPage:10,pageSizeOptions:[10,20,50,100],onChange:onPaginationChange})]}),readCreditsRate===false&&/*#__PURE__*/(0,jsx_runtime.jsx)(ErrorCodes/* ErrorCode403 */.$t,{mainMessage:"You don't have permission to view this data"}),currentEditType.openModal&&/*#__PURE__*/(0,jsx_runtime.jsx)(CreditsRateModal,{type:currentEditType.editType,reloadTableData:reloadTableData,onCancel:onCancelClick,openModal:currentEditType.openModal,permissions:permissions})]});}/* harmony default export */ const CreditsRate = (CreditsRateSettings);

/***/ }),

/***/ 83584:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   j: () => (/* binding */ CountryModule)
/* harmony export */ });
/* harmony import */ var _services_axiosInstance__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(83365);
/* harmony import */ var _Common_config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(21073);
class CountryModule{constructor(){this.endPoint="country";this.allEndpoint="country/all";this.getAllRecords=()=>{return _services_axiosInstance__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .A.get(this.allEndpoint);};this.getAvailableRecords=()=>{return _services_axiosInstance__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .A.get("".concat(this.endPoint,"/available-country"));};this.getRecordById=id=>{return _services_axiosInstance__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .A.get("".concat(this.endPoint,"/").concat(id));};this.deleteRecord=id=>{return _services_axiosInstance__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .A.delete("".concat(this.endPoint,"/").concat(id));};this.createRecord=data=>{return _services_axiosInstance__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .A.post(this.endPoint+"/",data,{headers:_Common_config__WEBPACK_IMPORTED_MODULE_1__/* .FormDataHeader */ .Y});};this.updateRecord=(data,id)=>{return _services_axiosInstance__WEBPACK_IMPORTED_MODULE_0__/* ["default"] */ .A.patch("".concat(this.endPoint,"/").concat(id),data,{headers:_Common_config__WEBPACK_IMPORTED_MODULE_1__/* .FormDataHeader */ .Y});};}}

/***/ })

}]);