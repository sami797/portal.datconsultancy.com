"use strict";
(self["webpackChunkdat_projects"] = self["webpackChunkdat_projects"] || []).push([[346],{

/***/ 65983:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__);

// EXPORTS
__webpack_require__.d(__webpack_exports__, {
  "default": () => (/* binding */ Conversations)
});

// EXTERNAL MODULE: ./node_modules/@babel/runtime/helpers/esm/objectSpread2.js
var objectSpread2 = __webpack_require__(89379);
// EXTERNAL MODULE: ./node_modules/react/index.js
var react = __webpack_require__(9950);
// EXTERNAL MODULE: ./node_modules/react-router-dom/dist/index.js
var dist = __webpack_require__(42074);
// EXTERNAL MODULE: ./node_modules/react-redux/es/index.js + 21 modules
var es = __webpack_require__(98341);
// EXTERNAL MODULE: ./node_modules/antd/es/layout/index.js
var layout = __webpack_require__(68832);
// EXTERNAL MODULE: ./node_modules/antd/es/typography/index.js + 15 modules
var typography = __webpack_require__(30377);
// EXTERNAL MODULE: ./node_modules/antd/es/message/index.js + 1 modules
var message = __webpack_require__(92759);
// EXTERNAL MODULE: ./node_modules/antd/es/skeleton/index.js + 11 modules
var skeleton = __webpack_require__(46005);
// EXTERNAL MODULE: ./node_modules/antd/es/menu/index.js + 5 modules
var menu = __webpack_require__(69216);
// EXTERNAL MODULE: ./node_modules/antd/es/avatar/index.js + 3 modules
var avatar = __webpack_require__(75871);
// EXTERNAL MODULE: ./node_modules/antd/es/tooltip/index.js
var tooltip = __webpack_require__(81541);
// EXTERNAL MODULE: ./node_modules/antd/es/spin/index.js
var spin = __webpack_require__(90650);
// EXTERNAL MODULE: ./node_modules/antd/es/image/index.js + 13 modules
var es_image = __webpack_require__(9206);
// EXTERNAL MODULE: ./node_modules/antd/es/upload/index.js + 19 modules
var upload = __webpack_require__(28013);
// EXTERNAL MODULE: ./node_modules/antd/es/button/index.js
var es_button = __webpack_require__(48538);
// EXTERNAL MODULE: ./node_modules/antd/es/mentions/index.js + 8 modules
var mentions = __webpack_require__(7817);
// EXTERNAL MODULE: ./node_modules/antd/es/drawer/index.js + 6 modules
var drawer = __webpack_require__(73780);
// EXTERNAL MODULE: ./node_modules/@babel/runtime/helpers/esm/extends.js
var esm_extends = __webpack_require__(58168);
;// ./node_modules/@ant-design/icons-svg/es/asn/RightCircleOutlined.js
// This icon file is generated automatically.
var RightCircleOutlined = {
  "icon": {
    "tag": "svg",
    "attrs": {
      "viewBox": "64 64 896 896",
      "focusable": "false"
    },
    "children": [{
      "tag": "path",
      "attrs": {
        "d": "M666.7 505.5l-246-178A8 8 0 00408 334v46.9c0 10.2 4.9 19.9 13.2 25.9L566.6 512 421.2 617.2c-8.3 6-13.2 15.6-13.2 25.9V690c0 6.5 7.4 10.3 12.7 6.5l246-178c4.4-3.2 4.4-9.8 0-13z"
      }
    }, {
      "tag": "path",
      "attrs": {
        "d": "M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"
      }
    }]
  },
  "name": "right-circle",
  "theme": "outlined"
};
/* harmony default export */ const asn_RightCircleOutlined = (RightCircleOutlined);
// EXTERNAL MODULE: ./node_modules/@ant-design/icons/es/components/AntdIcon.js + 5 modules
var AntdIcon = __webpack_require__(61187);
;// ./node_modules/@ant-design/icons/es/icons/RightCircleOutlined.js

// GENERATE BY ./scripts/generate.ts
// DON NOT EDIT IT MANUALLY




var RightCircleOutlined_RightCircleOutlined = function RightCircleOutlined(props, ref) {
  return /*#__PURE__*/react.createElement(AntdIcon/* default */.A, (0,esm_extends/* default */.A)({}, props, {
    ref: ref,
    icon: asn_RightCircleOutlined
  }));
};
if (false) {}
/* harmony default export */ const icons_RightCircleOutlined = (/*#__PURE__*/react.forwardRef(RightCircleOutlined_RightCircleOutlined));
;// ./node_modules/@ant-design/icons-svg/es/asn/LeftCircleOutlined.js
// This icon file is generated automatically.
var LeftCircleOutlined = {
  "icon": {
    "tag": "svg",
    "attrs": {
      "viewBox": "64 64 896 896",
      "focusable": "false"
    },
    "children": [{
      "tag": "path",
      "attrs": {
        "d": "M603.3 327.5l-246 178a7.95 7.95 0 000 12.9l246 178c5.3 3.8 12.7 0 12.7-6.5V643c0-10.2-4.9-19.9-13.2-25.9L457.4 512l145.4-105.2c8.3-6 13.2-15.6 13.2-25.9V334c0-6.5-7.4-10.3-12.7-6.5z"
      }
    }, {
      "tag": "path",
      "attrs": {
        "d": "M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"
      }
    }]
  },
  "name": "left-circle",
  "theme": "outlined"
};
/* harmony default export */ const asn_LeftCircleOutlined = (LeftCircleOutlined);
;// ./node_modules/@ant-design/icons/es/icons/LeftCircleOutlined.js

// GENERATE BY ./scripts/generate.ts
// DON NOT EDIT IT MANUALLY




var LeftCircleOutlined_LeftCircleOutlined = function LeftCircleOutlined(props, ref) {
  return /*#__PURE__*/react.createElement(AntdIcon/* default */.A, (0,esm_extends/* default */.A)({}, props, {
    ref: ref,
    icon: asn_LeftCircleOutlined
  }));
};
if (false) {}
/* harmony default export */ const icons_LeftCircleOutlined = (/*#__PURE__*/react.forwardRef(LeftCircleOutlined_LeftCircleOutlined));
// EXTERNAL MODULE: ./node_modules/@ant-design/icons/es/icons/LoadingOutlined.js
var LoadingOutlined = __webpack_require__(29008);
// EXTERNAL MODULE: ./node_modules/@ant-design/icons/es/icons/PaperClipOutlined.js
var PaperClipOutlined = __webpack_require__(78188);
// EXTERNAL MODULE: ./node_modules/@ant-design/icons/es/icons/CloseOutlined.js
var CloseOutlined = __webpack_require__(45908);
// EXTERNAL MODULE: ./src/Components/Templates/Layout/index.tsx + 28 modules
var Layout = __webpack_require__(81168);
// EXTERNAL MODULE: ./src/Components/Atoms/index.tsx + 12 modules
var Atoms = __webpack_require__(9394);
// EXTERNAL MODULE: ./src/Components/Icons/index.tsx + 58 modules
var Icons = __webpack_require__(63668);
// EXTERNAL MODULE: ./src/Components/Atoms/PreviewFile/index.tsx
var PreviewFile = __webpack_require__(10036);
// EXTERNAL MODULE: ./src/hooks/index.ts + 5 modules
var hooks = __webpack_require__(91970);
// EXTERNAL MODULE: ./src/Modules/Project/index.ts
var Project = __webpack_require__(50167);
// EXTERNAL MODULE: ./src/Modules/Project/permissions.ts
var Project_permissions = __webpack_require__(31203);
// EXTERNAL MODULE: ./src/helpers/common.ts
var common = __webpack_require__(88132);
// EXTERNAL MODULE: ./src/helpers/constants.ts
var constants = __webpack_require__(65944);
// EXTERNAL MODULE: ./src/helpers/useDebounce.ts
var useDebounce = __webpack_require__(28173);
// EXTERNAL MODULE: ./src/helpers/chat.gateway.ts
var chat_gateway = __webpack_require__(98891);
// EXTERNAL MODULE: ./node_modules/antd/es/popconfirm/index.js + 1 modules
var popconfirm = __webpack_require__(56231);
// EXTERNAL MODULE: ./node_modules/@ant-design/icons/es/icons/DeleteOutlined.js
var DeleteOutlined = __webpack_require__(78433);
// EXTERNAL MODULE: ./node_modules/@ant-design/icons/es/icons/UserOutlined.js + 1 modules
var UserOutlined = __webpack_require__(79378);
// EXTERNAL MODULE: ./src/Components/Atoms/UserPopver/index.ts
var UserPopver = __webpack_require__(54405);
// EXTERNAL MODULE: ./src/services/tokenService.ts
var tokenService = __webpack_require__(92966);
// EXTERNAL MODULE: ./src/Components/Atoms/PhotoView/index.tsx + 8 modules
var PhotoView = __webpack_require__(53447);
// EXTERNAL MODULE: ./node_modules/moment/moment.js
var moment = __webpack_require__(59051);
var moment_default = /*#__PURE__*/__webpack_require__.n(moment);
;// ./src/Components/Organisms/Conversations/styles.module.scss
// extracted by mini-css-extract-plugin
/* harmony default export */ const styles_module = ({"layout":"styles_layout__6icCo","sider":"styles_sider__d9wVQ","myProjectList":"styles_myProjectList__EvFW6","activeProject":"styles_activeProject__WJcl-","sider_header":"styles_sider_header__A3g5H","badge":"styles_badge__R-00f","sider_item_title":"styles_sider_item_title__yra+5","sider_item_last_message":"styles_sider_item_last_message__PgWWz","header":"styles_header__HCTDy","header_content":"styles_header_content__tuweB","header_content_title":"styles_header_content_title__NajfL","content":"styles_content__vtSGh","content_empty_wrapper":"styles_content_empty_wrapper__eCFiy","content_empty":"styles_content_empty__g4cNj","content_loader":"styles_content_loader__ObodF","content_item":"styles_content_item__iKoAA","card":"styles_card__7v0HE","card_wrapper_container":"styles_card_wrapper_container__mrkNu","card_wrapper":"styles_card_wrapper__FrzoQ","card_wrapper_owner":"styles_card_wrapper_owner__aH2en","card_content":"styles_card_content__1Mpvo","card_content_owner":"styles_card_content_owner__qdNws","card_content_other":"styles_card_content_other__YGN-7","card_sender":"styles_card_sender__g5WmT","card_sender_owner":"styles_card_sender_owner__6VSua","card_sender_other":"styles_card_sender_other__ttFtO","card_sender_name":"styles_card_sender_name__R36j4","card_sent_at":"styles_card_sent_at__4U1Bx","card_message":"styles_card_message__jnle8","card_message_mention":"styles_card_message_mention__I300A","conversations_footer":"styles_conversations_footer__pd3q7","conversations_form":"styles_conversations_form__kWguF","conversations_form_wrapper":"styles_conversations_form_wrapper__MuRJ8","conversations_form_input_wrapper":"styles_conversations_form_input_wrapper__WkOSC","conversations_form_input":"styles_conversations_form_input__0+Hqp","conversations_form_send":"styles_conversations_form_send__+d4-U","conversations_form_send_loader":"styles_conversations_form_send_loader__fYOYA","collapsed_sider":"styles_collapsed_sider__-CezW","collapsed_sider_header":"styles_collapsed_sider_header__mJ4lL","collapsed_sider_header_title":"styles_collapsed_sider_header_title__Ndw2K","sider_collapse_icon":"styles_sider_collapse_icon__c3Yx4"});
// EXTERNAL MODULE: ./node_modules/react/jsx-runtime.js
var jsx_runtime = __webpack_require__(44414);
;// ./src/Components/Organisms/Conversations/card.tsx
const ConversationCards=props=>{var _data$User,_data$User2,_data$User3,_data$User4,_data$message,_data$Media,_data$Media2;const{data,setSelectedFile,onRemoveConversation,projectMembers}=props;const currentUser=tokenService/* default */.A.getUserData();const access_token=tokenService/* default */.A.getLocalAccessToken();const isOwner=(data===null||data===void 0?void 0:(_data$User=data.User)===null||_data$User===void 0?void 0:_data$User.id)===(currentUser===null||currentUser===void 0?void 0:currentUser.id);const isDateGreaterThan15Min=new Date(data===null||data===void 0?void 0:data.addedDate).getTime()+15*60*1000<new Date().getTime();const[showDelete,setShowDelete]=(0,react.useState)(false);return/*#__PURE__*/(0,jsx_runtime.jsxs)("div",{className:"".concat(styles_module.card_wrapper_container," ").concat(isOwner?styles_module.card_wrapper_owner:styles_module.card_wrapper),onMouseEnter:()=>setShowDelete(true),onMouseLeave:()=>setShowDelete(false),children:[isOwner&&showDelete&&!isDateGreaterThan15Min&&/*#__PURE__*/(0,jsx_runtime.jsx)(popconfirm/* default */.A,{title:"Are you sure you want to delete this conversation?",okText:"Yes",cancelText:"No",placement:"left",onConfirm:()=>onRemoveConversation(data===null||data===void 0?void 0:data.id),children:/*#__PURE__*/(0,jsx_runtime.jsx)(DeleteOutlined/* default */.A,{style:{color:"red"}})}),/*#__PURE__*/(0,jsx_runtime.jsxs)("div",{className:"".concat(styles_module.card),children:[/*#__PURE__*/(0,jsx_runtime.jsx)("div",{className:styles_module.card_avatar,children:!isOwner&&/*#__PURE__*/(0,jsx_runtime.jsx)(avatar/* default */.A,{src:"".concat(constants/* RESOURCE_BASE_URL */.to).concat(data===null||data===void 0?void 0:(_data$User2=data.User)===null||_data$User2===void 0?void 0:_data$User2.profile),icon:/*#__PURE__*/(0,jsx_runtime.jsx)(UserOutlined/* default */.A,{}),size:'default'})}),/*#__PURE__*/(0,jsx_runtime.jsxs)("div",{className:"".concat(styles_module.card_content," ").concat(isOwner?styles_module.card_content_owner:styles_module.card_content_other),children:[/*#__PURE__*/(0,jsx_runtime.jsxs)("div",{className:"".concat(styles_module.card_sender," ").concat(isOwner?styles_module.card_sender_owner:styles_module.card_sender_other),children:[!isOwner&&/*#__PURE__*/(0,jsx_runtime.jsx)(UserPopver/* UserPopover */.t,{user:data===null||data===void 0?void 0:data.User,type:"user",children:/*#__PURE__*/(0,jsx_runtime.jsx)("p",{className:styles_module.card_sender_name,children:"".concat(data===null||data===void 0?void 0:(_data$User3=data.User)===null||_data$User3===void 0?void 0:_data$User3.firstName," ").concat(data===null||data===void 0?void 0:(_data$User4=data.User)===null||_data$User4===void 0?void 0:_data$User4.lastName)})}),/*#__PURE__*/(0,jsx_runtime.jsx)("span",{className:styles_module.card_sent_at,title:moment_default()(data.addedDate).format("DD MMM, YYYY hh:mm A"),children:moment_default()(data.addedDate).fromNow()})]}),/*#__PURE__*/(0,jsx_runtime.jsx)("div",{className:styles_module.card_message,children:/*#__PURE__*/(0,jsx_runtime.jsx)("div",{dangerouslySetInnerHTML:{__html:data===null||data===void 0?void 0:(_data$message=data.message)===null||_data$message===void 0?void 0:_data$message.replace(/@(\w+\s*\w*)/g,(match,p1)=>{const name=p1.replace(/@|\(|\)/g,'');// console.log('userId', name);
const user=projectMembers===null||projectMembers===void 0?void 0:projectMembers.find(member=>{var _ref,_member$User,_member$User2;return(_ref="".concat(member===null||member===void 0?void 0:(_member$User=member.User)===null||_member$User===void 0?void 0:_member$User.firstName," ").concat(member===null||member===void 0?void 0:(_member$User2=member.User)===null||_member$User2===void 0?void 0:_member$User2.lastName))===null||_ref===void 0?void 0:_ref.includes(name);});/**
                   *  <UserPopover user={user?.User} type='user'>
                   *   <span className={styles.card_message_mention}>
                   *    {match}{" "}
                   *  </span>
                   * </UserPopover> as any
                   *  */if(user){return"<span class=".concat(styles_module.card_message_mention,">").concat(match,"</span>");}else{return match;}})}})}),(data===null||data===void 0?void 0:(_data$Media=data.Media)===null||_data$Media===void 0?void 0:_data$Media.length)>0&&/*#__PURE__*/(0,jsx_runtime.jsx)("div",{className:styles_module.conversation__files,children:data===null||data===void 0?void 0:(_data$Media2=data.Media)===null||_data$Media2===void 0?void 0:_data$Media2.map((media,index)=>{var _media$fileType;return/*#__PURE__*/(0,jsx_runtime.jsx)("div",{className:styles_module.conversation__files_item,children:(_media$fileType=media.fileType)!==null&&_media$fileType!==void 0&&_media$fileType.includes("image")?/*#__PURE__*/(0,jsx_runtime.jsx)(PhotoView/* default */.A,{images:["".concat(constants/* PROTECTED_RESOURCE_BASE_URL */.SO).concat(media.path,"?authKey=").concat(access_token)],width:300,height:150,style:{borderRadius:5,objectFit:'cover'}}):/*#__PURE__*/(0,jsx_runtime.jsx)(es_image/* default */.A,{src:"/images/doc.png",alt:"Document-".concat(index),preview:false,width:300,height:150,style:{borderRadius:5,objectFit:'contain'},onClick:()=>setSelectedFile({path:media.path,open:true})})},"media-".concat(index));})})]})]})]});};/* harmony default export */ const card = (ConversationCards);
// EXTERNAL MODULE: ./src/services/axiosInstance.ts
var axiosInstance = __webpack_require__(83365);
// EXTERNAL MODULE: ./node_modules/antd/es/tag/index.js + 1 modules
var tag = __webpack_require__(12916);
// EXTERNAL MODULE: ./src/Components/Atoms/Headings/index.tsx
var Headings = __webpack_require__(35751);
// EXTERNAL MODULE: ./src/helpers/commonEnums.ts
var commonEnums = __webpack_require__(2360);
// EXTERNAL MODULE: ./src/Components/Organisms/Skeletons/index.tsx
var Skeletons = __webpack_require__(70619);
;// ./src/Components/Organisms/Conversations/Details/style.module.scss
// extracted by mini-css-extract-plugin
/* harmony default export */ const style_module = ({"details":"style_details__83AGw","details_card":"style_details_card__tOEr1","details_item":"style_details_item__obob9","details_item_label":"style_details_item_label__PXGKl","details_item_value":"style_details_item_value__4hJLG","members":"style_members__nbhoL","members_item":"style_members_item__4pJI-","members_item_name":"style_members_item_name__CPHWO"});
// EXTERNAL MODULE: ./src/Components/Organisms/Projects/Details/Sections/Tabs/Files/media.tsx
var media = __webpack_require__(48262);
// EXTERNAL MODULE: ./src/Components/Icons/external.tsx
var external = __webpack_require__(19642);
// EXTERNAL MODULE: ./src/Components/Atoms/CustomEmpty/index.tsx
var CustomEmpty = __webpack_require__(49758);
;// ./src/Components/Organisms/Conversations/Details/index.tsx
const{Text}=typography/* default */.A;const ConversationDetail=_ref=>{var _project$Client,_project$Client2,_project$Client3,_project$Client4,_project$ProjectType,_project$ProjectState,_project$ProjectState2,_project$ProjectState3,_project$ProjectState4,_project$SubmissionBy,_project$SubmissionBy2,_project$SubmissionBy3,_project$SubmissionBy4,_projectFiles$data;let{details,setIsManageMediaOpen}=_ref;const project=details===null||details===void 0?void 0:details.data;const loading=details===null||details===void 0?void 0:details.loading;const projectFiles=details===null||details===void 0?void 0:details.files;const members=project===null||project===void 0?void 0:project.ProjectMembers;return/*#__PURE__*/(0,jsx_runtime.jsx)("div",{className:style_module.details,children:loading?/*#__PURE__*/(0,jsx_runtime.jsx)(Skeletons/* default */.A,{items:2}):/*#__PURE__*/(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[/*#__PURE__*/(0,jsx_runtime.jsxs)("div",{className:style_module.details_card,children:[/*#__PURE__*/(0,jsx_runtime.jsxs)("div",{className:style_module.details_item,children:[/*#__PURE__*/(0,jsx_runtime.jsx)("p",{className:style_module.details_item_label,children:"Client"}),(project===null||project===void 0?void 0:project.Client)&&/*#__PURE__*/(0,jsx_runtime.jsxs)("div",{className:style_module.details_item_value,children:[project!==null&&project!==void 0&&(_project$Client=project.Client)!==null&&_project$Client!==void 0&&_project$Client.logo?/*#__PURE__*/(0,jsx_runtime.jsx)(es_image/* default */.A,{src:"".concat(constants/* RESOURCE_BASE_URL */.to).concat(project===null||project===void 0?void 0:(_project$Client2=project.Client)===null||_project$Client2===void 0?void 0:_project$Client2.logo),alt:project===null||project===void 0?void 0:(_project$Client3=project.Client)===null||_project$Client3===void 0?void 0:_project$Client3.name,preview:false,width:24,style:{objectFit:'contain'}}):/*#__PURE__*/(0,jsx_runtime.jsx)(avatar/* default */.A,{size:24,icon:/*#__PURE__*/(0,jsx_runtime.jsx)(UserOutlined/* default */.A,{}),style:{border:'1px solid var(--color-border)'}}),/*#__PURE__*/(0,jsx_runtime.jsx)("p",{className:"mb-0",children:project===null||project===void 0?void 0:(_project$Client4=project.Client)===null||_project$Client4===void 0?void 0:_project$Client4.name})]})]}),/*#__PURE__*/(0,jsx_runtime.jsxs)("div",{className:style_module.details_item,children:[/*#__PURE__*/(0,jsx_runtime.jsx)("p",{className:style_module.details_item_label,children:"Project Type"}),/*#__PURE__*/(0,jsx_runtime.jsx)("p",{className:"".concat(style_module.details_item_value," mb-0"),children:project===null||project===void 0?void 0:(_project$ProjectType=project.ProjectType)===null||_project$ProjectType===void 0?void 0:_project$ProjectType.title})]}),/*#__PURE__*/(0,jsx_runtime.jsxs)("div",{className:style_module.details_item,children:[/*#__PURE__*/(0,jsx_runtime.jsx)("p",{className:style_module.details_item_label,children:"Project State"}),/*#__PURE__*/(0,jsx_runtime.jsx)(tag/* default */.A,{color:project===null||project===void 0?void 0:(_project$ProjectState=project.ProjectState)===null||_project$ProjectState===void 0?void 0:_project$ProjectState.bgColor,children:/*#__PURE__*/(0,jsx_runtime.jsx)(Text,{style:{width:'100%',maxWidth:250,color:project===null||project===void 0?void 0:(_project$ProjectState2=project.ProjectState)===null||_project$ProjectState2===void 0?void 0:_project$ProjectState2.textColor},ellipsis:{tooltip:project===null||project===void 0?void 0:(_project$ProjectState3=project.ProjectState)===null||_project$ProjectState3===void 0?void 0:_project$ProjectState3.title},children:project===null||project===void 0?void 0:(_project$ProjectState4=project.ProjectState)===null||_project$ProjectState4===void 0?void 0:_project$ProjectState4.title})})]}),/*#__PURE__*/(0,jsx_runtime.jsxs)("div",{className:style_module.details_item,children:[/*#__PURE__*/(0,jsx_runtime.jsx)("p",{className:style_module.details_item_label,children:"Reference Number"}),/*#__PURE__*/(0,jsx_runtime.jsx)("p",{className:"".concat(style_module.details_item_value," mb-0"),children:project===null||project===void 0?void 0:project.referenceNumber})]}),/*#__PURE__*/(0,jsx_runtime.jsxs)("div",{className:style_module.details_item,children:[/*#__PURE__*/(0,jsx_runtime.jsx)("p",{className:style_module.details_item_label,children:"Submission By"}),(project===null||project===void 0?void 0:project.SubmissionBy)&&/*#__PURE__*/(0,jsx_runtime.jsxs)("div",{className:style_module.details_item_value,children:[project!==null&&project!==void 0&&(_project$SubmissionBy=project.SubmissionBy)!==null&&_project$SubmissionBy!==void 0&&_project$SubmissionBy.logo?/*#__PURE__*/(0,jsx_runtime.jsx)(es_image/* default */.A,{src:"".concat(constants/* RESOURCE_BASE_URL */.to).concat(project===null||project===void 0?void 0:(_project$SubmissionBy2=project.SubmissionBy)===null||_project$SubmissionBy2===void 0?void 0:_project$SubmissionBy2.logo),alt:project===null||project===void 0?void 0:(_project$SubmissionBy3=project.SubmissionBy)===null||_project$SubmissionBy3===void 0?void 0:_project$SubmissionBy3.name,preview:false,width:24,style:{objectFit:'contain'}}):/*#__PURE__*/(0,jsx_runtime.jsx)(avatar/* default */.A,{size:24,icon:/*#__PURE__*/(0,jsx_runtime.jsx)(UserOutlined/* default */.A,{}),style:{border:'1px solid var(--color-border)'}}),/*#__PURE__*/(0,jsx_runtime.jsx)("p",{className:"mb-0",children:project===null||project===void 0?void 0:(_project$SubmissionBy4=project.SubmissionBy)===null||_project$SubmissionBy4===void 0?void 0:_project$SubmissionBy4.name})]})]})]}),/*#__PURE__*/(0,jsx_runtime.jsxs)("div",{className:style_module.details_card,children:[/*#__PURE__*/(0,jsx_runtime.jsxs)("div",{className:"d-flex align-center",children:[/*#__PURE__*/(0,jsx_runtime.jsx)(Headings/* default */.A,{color:"dark-sub",children:"Files"}),/*#__PURE__*/(0,jsx_runtime.jsx)(es_button/* default */.A,{type:"link",onClick:()=>setIsManageMediaOpen(true),className:"ml-auto font-size-normal color-dark-sub",style:{padding:0,margin:0},children:"Manage"})]}),(projectFiles===null||projectFiles===void 0?void 0:(_projectFiles$data=projectFiles.data)===null||_projectFiles$data===void 0?void 0:_projectFiles$data.length)>0?/*#__PURE__*/(0,jsx_runtime.jsx)(media/* default */.A,{data:projectFiles===null||projectFiles===void 0?void 0:projectFiles.data,meta:projectFiles===null||projectFiles===void 0?void 0:projectFiles.meta,onRefresh:projectFiles===null||projectFiles===void 0?void 0:projectFiles.onRefresh,projectId:project===null||project===void 0?void 0:project.id,fromChat:true}):/*#__PURE__*/(0,jsx_runtime.jsx)(CustomEmpty/* default */.A,{className:"mt-1",description:"No files"})]}),/*#__PURE__*/(0,jsx_runtime.jsxs)("div",{className:style_module.details_card,children:[/*#__PURE__*/(0,jsx_runtime.jsxs)("div",{className:"d-flex align-center",children:[/*#__PURE__*/(0,jsx_runtime.jsx)(Headings/* default */.A,{color:"dark-sub",className:"ml-2",children:"".concat(members===null||members===void 0?void 0:members.length," ").concat((members===null||members===void 0?void 0:members.length)>1?'Members':'Member')}),/*#__PURE__*/(0,jsx_runtime.jsxs)("a",{className:"ml-auto d-flex align-center",href:"/projects/".concat(project===null||project===void 0?void 0:project.slug,"?id=").concat(project===null||project===void 0?void 0:project.id),target:"_blank",rel:"noreferrer",children:[/*#__PURE__*/(0,jsx_runtime.jsx)(Headings/* default */.A,{color:"dark-sub",children:"Manage"}),/*#__PURE__*/(0,jsx_runtime.jsx)(external/* ExternalIcon */.X,{className:"mr-0"})]})]}),(members===null||members===void 0?void 0:members.length)>0?/*#__PURE__*/(0,jsx_runtime.jsx)("div",{className:style_module.members,children:members===null||members===void 0?void 0:members.map(member=>{const{User,projectRole}=member;const isIncharge=projectRole===commonEnums/* ProjectRoleEnum */.b2['projectIncharge'];return/*#__PURE__*/(0,jsx_runtime.jsx)("div",{className:style_module.members_item,children:/*#__PURE__*/(0,jsx_runtime.jsxs)(UserPopver/* UserPopover */.t,{type:"user",user:User,className:"d-flex align-center",children:[/*#__PURE__*/(0,jsx_runtime.jsx)(avatar/* default */.A,{size:32,src:"".concat(constants/* RESOURCE_BASE_URL */.to).concat(User===null||User===void 0?void 0:User.profile),icon:/*#__PURE__*/(0,jsx_runtime.jsx)(UserOutlined/* default */.A,{}),style:{border:'1px solid var(--color-border)'}}),/*#__PURE__*/(0,jsx_runtime.jsx)("p",{className:style_module.members_item_name,children:"".concat(User===null||User===void 0?void 0:User.firstName," ").concat(User===null||User===void 0?void 0:User.lastName)}),isIncharge&&/*#__PURE__*/(0,jsx_runtime.jsx)(tag/* default */.A,{color:"blue",className:"ml-2",children:"Incharge"})]})},User===null||User===void 0?void 0:User.uuid);})}):/*#__PURE__*/(0,jsx_runtime.jsx)(CustomEmpty/* default */.A,{className:"mt-1",description:"No members"})]})]})});};/* harmony default export */ const Details = (ConversationDetail);
// EXTERNAL MODULE: ./src/Components/Organisms/Projects/Details/Sections/Tabs/Files/manage-media.tsx
var manage_media = __webpack_require__(26778);
// EXTERNAL MODULE: ./node_modules/react-infinite-scroll-component/dist/index.es.js
var index_es = __webpack_require__(50416);
;// ./src/Components/Organisms/Conversations/index.tsx
const{Header,Sider,Content,Footer}=layout/* default */.A;const{Text: Conversations_Text,Title}=typography/* default */.A;const AllConversations=()=>{var _projectConversations,_projectConversations2,_projectConversations4,_selectedProject$Proj3,_projectConversations5,_projectConversations6,_projectConversations7,_projectConversations8,_projectConversations9,_projectConversations10,_projectConversations11;// available permissions
const permissionSlug=(0,common/* getPermissionSlugs */.AH)(Project_permissions/* ProjectPermissionsEnum */.l);const{userPermissions}=(0,es/* useSelector */.d4)(state=>state.usersReducer);const permissions=userPermissions;const[messageApi,contextHolder]=message/* default */.Ay.useMessage();const currentUser=tokenService/* default */.A.getUserData();const[searchParams,setSearchParams]=(0,dist/* useSearchParams */.ok)();const projectIdFromURL=searchParams.get("projectId");const[selectedProject,setSelectedProject]=(0,react.useState)();const[isShiftPressed,setIsShiftPressed]=(0,react.useState)(false);const[isManageMediaOpen,setIsManageMediaOpen]=(0,react.useState)(false);const[searchTerm,setSearchTerm]=(0,react.useState)();const debouncedSearchTerm=(0,useDebounce/* useDebounce */.d)(searchTerm,500);const[projectConversations,setProjectConversations]=(0,react.useState)({data:[],meta:{},loading:{default:true,reload:false},showEndMessage:false});const[hasUserInteracted,setHasUserInteracted]=(0,react.useState)(false);const interactionRef=(0,react.useRef)();const chatContainerRef=(0,react.useRef)(null);interactionRef.current=hasUserInteracted;const[conversations,setConversations]=(0,react.useState)({content:'',loading:false});const[fileList,setFileList]=(0,react.useState)([]);const[selectedFile,setSelectedFile]=(0,react.useState)({path:'',open:false});const[details,setDetails]=(0,react.useState)({collapsed:false,fetched:false});const[collapsed,setCollapsed]=(0,react.useState)(false);/** Project Module instance for API calls */const module=(0,react.useMemo)(()=>new Project/* ProjectModule */.K(),[]);/** Project Files and details fetch condition */const detailsCondition=(0,react.useMemo)(()=>{return!!(selectedProject!==null&&selectedProject!==void 0&&selectedProject.slug)&&details.fetched;},[details.fetched,selectedProject===null||selectedProject===void 0?void 0:selectedProject.slug]);/** Whether there's more data to be fetched or not in the conversations */const hasMore=(0,react.useMemo)(()=>{var _conversations$data,_conversations$meta;const conversations=projectConversations;return(conversations===null||conversations===void 0?void 0:(_conversations$data=conversations.data)===null||_conversations$data===void 0?void 0:_conversations$data.length)<(conversations===null||conversations===void 0?void 0:(_conversations$meta=conversations.meta)===null||_conversations$meta===void 0?void 0:_conversations$meta.total);},[projectConversations===null||projectConversations===void 0?void 0:(_projectConversations=projectConversations.data)===null||_projectConversations===void 0?void 0:_projectConversations.length,projectConversations===null||projectConversations===void 0?void 0:(_projectConversations2=projectConversations.meta)===null||_projectConversations2===void 0?void 0:_projectConversations2.total]);// Project List Fetch
const{data:projectsList,onRefresh:onRefreshProjectList,loading:loadingProjectsList,setData:setProjectsList}=(0,hooks/* useFetchData */.Gs)({method:module.getProjectListForChat});// Project Details Fetch
const{data:selectedProjectDetails,onRefresh,loading:selectedProjectDetailsLoading}=(0,hooks/* useConditionFetchData */.P6)({method:()=>module.getRecordBySlug(selectedProject===null||selectedProject===void 0?void 0:selectedProject.slug),condition:detailsCondition});// Project Files Fetch
const{data:projectFiles,onRefresh:onRefreshProjectFiles,loading:loadingProjectFiles,meta:projectFilesMeta}=(0,hooks/* useConditionFetchData */.P6)({method:module.getProjectResources,initialQuery:{projectId:selectedProject===null||selectedProject===void 0?void 0:selectedProject.id,perPage:12},condition:detailsCondition});/** Project Members For Mentions */const projectMembersOptions=(0,react.useMemo)(()=>{var _selectedProject$Proj;return selectedProject===null||selectedProject===void 0?void 0:(_selectedProject$Proj=selectedProject.ProjectMembers)===null||_selectedProject$Proj===void 0?void 0:_selectedProject$Proj.map(member=>{var _member$User,_member$User2,_member$User3;const name="".concat(member===null||member===void 0?void 0:(_member$User=member.User)===null||_member$User===void 0?void 0:_member$User.firstName," ").concat(member===null||member===void 0?void 0:(_member$User2=member.User)===null||_member$User2===void 0?void 0:_member$User2.lastName);const userId=member===null||member===void 0?void 0:(_member$User3=member.User)===null||_member$User3===void 0?void 0:_member$User3.id;return{label:name,value:"[".concat(name,"](").concat(userId,")")};});},[selectedProject===null||selectedProject===void 0?void 0:selectedProject.ProjectMembers]);const projectMembers=(0,react.useMemo)(()=>{var _selectedProject$Proj2;return selectedProject===null||selectedProject===void 0?void 0:(_selectedProject$Proj2=selectedProject.ProjectMembers)===null||_selectedProject$Proj2===void 0?void 0:_selectedProject$Proj2.map(member=>{var _member$User4;return member===null||member===void 0?void 0:(_member$User4=member.User)===null||_member$User4===void 0?void 0:_member$User4.firstName;});},[selectedProject===null||selectedProject===void 0?void 0:selectedProject.ProjectMembers]);const firstThreeMembers=(0,react.useMemo)(()=>projectMembers===null||projectMembers===void 0?void 0:projectMembers.slice(0,3),[projectMembers]);const otherMembersCount=(0,react.useMemo)(()=>{return(projectMembers===null||projectMembers===void 0?void 0:projectMembers.length)-(firstThreeMembers===null||firstThreeMembers===void 0?void 0:firstThreeMembers.length);},[firstThreeMembers,projectMembers]);/** Get project conversations */const onGetProjectConversations=(0,react.useCallback)(function(query){let type=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"default";const projectId=query===null||query===void 0?void 0:query.projectId;const params=(0,objectSpread2/* default */.A)({projectId:projectId},query);setProjectConversations(prev=>(0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},prev),{},{loading:type==="default"?{default:true,reload:false}:{default:false,reload:true}}));module.getProjectConversations(params).then(res=>{const{data,meta}=res===null||res===void 0?void 0:res.data;// remove the duplicate data
const uniqueData=data.filter(item=>{var _projectConversations3;return!(projectConversations!==null&&projectConversations!==void 0&&(_projectConversations3=projectConversations.data)!==null&&_projectConversations3!==void 0&&_projectConversations3.some(prevItem=>prevItem.id===item.id));});const finalData=type==="default"?data:[...(projectConversations===null||projectConversations===void 0?void 0:projectConversations.data),...uniqueData];setProjectConversations(prev=>(0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},prev),{},{data:finalData,meta:meta,loading:{default:false,reload:false},showEndMessage:finalData.length===(meta===null||meta===void 0?void 0:meta.total)}));}).catch(err=>{const errorMessage=(0,common/* handleError */.H4)(err);message/* default */.Ay.error(errorMessage||"Something went wrong!");setProjectConversations(prev=>(0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},prev),{},{loading:{default:false,reload:false}}));});},[projectConversations]);/**Function to add a conversation
   * @param {AddConversationType} values values of the conversation to be added
   */const onAddConversation=(0,react.useCallback)(values=>{const projectId=selectedProject===null||selectedProject===void 0?void 0:selectedProject.id;if(!projectId)return;if(permissions.updateProject===true){setConversations(prev=>(0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},prev),{},{loading:true}));module.addProjectConversation((0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},values),{},{projectId:projectId})).then(res=>{setConversations({loading:false,content:''});let newMessage=res.data.data;if(newMessage&&newMessage.projectId){setProjectConversations(prev=>(0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},prev),{},{loading:{default:false,reload:false},data:[newMessage,...prev.data]}));}}).catch(err=>{const errorMessage=(0,common/* handleError */.H4)(err);message/* default */.Ay.error(errorMessage||'Something went wrong');setConversations(prev=>(0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},prev),{},{loading:false}));});}else{message/* default */.Ay.error('You do not have permission to add conversations');}},[selectedProject===null||selectedProject===void 0?void 0:selectedProject.id,permissions]);// create a new conversation object
const createProjectConversations=message=>{var _message$Media;return{addedDate:message===null||message===void 0?void 0:message.addedDate,message:message===null||message===void 0?void 0:message.message,mediaCount:message===null||message===void 0?void 0:(_message$Media=message.Media)===null||_message$Media===void 0?void 0:_message$Media.length};};// update the project conversations
const updateProjectConversations=message=>{setProjectConversations(prev=>(0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},prev),{},{loading:{default:false,reload:false},data:[message,...prev.data.filter(ele=>ele.id!==message.id)]}));};// update the project list
const updateProjectsList=props=>{const{message,_Project,_ProjectConversations,_ProjectMembers,unreadConversationCount}=props;let newProject={id:_Project===null||_Project===void 0?void 0:_Project.id,title:_Project===null||_Project===void 0?void 0:_Project.title,slug:_Project===null||_Project===void 0?void 0:_Project.slug,onHold:_Project===null||_Project===void 0?void 0:_Project.onHold,referenceNumber:_Project===null||_Project===void 0?void 0:_Project.referenceNumber,ProjectMembers:_ProjectMembers,ProjectConversation:_ProjectConversations,unreadConversationCount:(message===null||message===void 0?void 0:message.projectId)===Number(projectIdFromURL)?0:unreadConversationCount};setProjectsList(prev=>{let newProjectList=prev===null||prev===void 0?void 0:prev.filter(project=>project.id!==message.projectId);return[newProject,...newProjectList];});};const updateConversation=(message,selectedProjectData)=>{const projectIdFromURL=selectedProjectData===null||selectedProjectData===void 0?void 0:selectedProjectData.id;if(message&&message.projectId){const _ProjectConversations=createProjectConversations(message);const _Project=message.Project;const unreadConversationCount=message.unreadConversationCount||0;const _ProjectMembers=message.Project.ProjectMembers;// update the conversation if the project is selected
if(message.projectId===projectIdFromURL){updateProjectConversations(message);}if(interactionRef.current&&message.userId!==(currentUser===null||currentUser===void 0?void 0:currentUser.id)){(0,common/* PlayNotificationSound */.rK)();}// Prepend the new message to the list of conversations (project list) if the project is not selected
if(message.projectId!==projectIdFromURL){updateProjectsList({message,_Project,_ProjectConversations,_ProjectMembers,unreadConversationCount});}}};/** Handle Keyboards events */const handleKeyDown=event=>{if(event.key==='Enter'&&isShiftPressed){event.preventDefault();if(conversations.content.trim()==='')return;onAddConversation({message:conversations===null||conversations===void 0?void 0:conversations.content});}else if(event.key==='Shift'){setIsShiftPressed(true);}};/** Handle Keyboards events */const handleKeyUp=event=>{if(event.key==='Shift'){setIsShiftPressed(false);}};/**Function to remove a conversation
   * @param {number} conversationId id of the conversation to be deleted
   */const onRemoveConversation=(0,react.useCallback)(conversationId=>{const projectId=selectedProject===null||selectedProject===void 0?void 0:selectedProject.id;if(permissions.updateProject===true){module.removeProjectConversations(conversationId).then(res=>{var _res$data;message/* default */.Ay.success((res===null||res===void 0?void 0:(_res$data=res.data)===null||_res$data===void 0?void 0:_res$data.message)||'conversation deleted successfully');onGetProjectConversations({projectId:projectId},"reload");// remove the deleted conversation from the list of conversations
setProjectConversations(prev=>(0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},prev),{},{data:prev.data.filter(item=>item.id!==conversationId)}));}).catch(err=>{const errorMessage=(0,common/* handleError */.H4)(err);message/* default */.Ay.error(errorMessage||'Something went wrong');});}else{message/* default */.Ay.error('You do not have permission to delete conversations');}},[selectedProject===null||selectedProject===void 0?void 0:selectedProject.id]);/** Upload file to server */const fileUpload=(0,react.useCallback)(async options=>{const{onSuccess,onError,file}=options;const fmData=new FormData();const config={headers:{"content-type":"multipart/form-data"}};fmData.append("files[]",file);const projectId=selectedProject===null||selectedProject===void 0?void 0:selectedProject.id;const handleSuccess=()=>{onSuccess&&onSuccess({status:200});setFileList([]);onGetProjectConversations({projectId:projectId},"reload");};const handleErrors=err=>{const errorMessage=(0,common/* handleError */.H4)(err);setFileList([]);const messageType=errorMessage==="You do not have permission to upload files"?"permission":"error";messageApi.open({key:messageType,type:"error",duration:5,content:errorMessage});onError&&onError(new Error('Upload failed'));};try{if(permissions.updateProject===true){await axiosInstance/* default */.A.post("project/uploadConversationFiles/".concat(projectId),fmData,config);handleSuccess();}else{throw new Error("You do not have permission to upload files");}}catch(err){handleErrors(err);}},[selectedProject===null||selectedProject===void 0?void 0:selectedProject.id]);/** Get next conversations */const onGetNextConversations=(0,react.useCallback)(()=>{var _conversations$meta2,_conversations$meta3;const conversations=projectConversations;if((conversations===null||conversations===void 0?void 0:(_conversations$meta2=conversations.meta)===null||_conversations$meta2===void 0?void 0:_conversations$meta2.page)<(conversations===null||conversations===void 0?void 0:(_conversations$meta3=conversations.meta)===null||_conversations$meta3===void 0?void 0:_conversations$meta3.pageCount)){var _conversations$data2,_conversations$data3,_conversations$data4;const dataLength=(conversations===null||conversations===void 0?void 0:(_conversations$data2=conversations.data)===null||_conversations$data2===void 0?void 0:_conversations$data2.length)||0;const lastMessageId=conversations===null||conversations===void 0?void 0:(_conversations$data3=conversations.data)===null||_conversations$data3===void 0?void 0:(_conversations$data4=_conversations$data3[dataLength-1])===null||_conversations$data4===void 0?void 0:_conversations$data4.id;const params={projectId:selectedProject===null||selectedProject===void 0?void 0:selectedProject.id,before:lastMessageId};onGetProjectConversations(params,"reload");}},[projectConversations,selectedProject===null||selectedProject===void 0?void 0:selectedProject.id]);// Scroll to bottom of the chat container
(0,react.useEffect)(()=>{if(chatContainerRef.current){chatContainerRef.current.scrollTop=chatContainerRef.current.scrollHeight;}},[projectConversations===null||projectConversations===void 0?void 0:(_projectConversations4=projectConversations.data)===null||_projectConversations4===void 0?void 0:_projectConversations4.length]);// if the selected project changes, close the collapsed sidebar
(0,react.useEffect)(()=>{setDetails(prev=>(0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},prev),{},{collapsed:false}));},[selectedProject===null||selectedProject===void 0?void 0:selectedProject.id]);// fetch the project details 
(0,react.useEffect)(()=>{if(selectedProject!==null&&selectedProject!==void 0&&selectedProject.slug&&details.fetched){onRefresh();}},[selectedProject===null||selectedProject===void 0?void 0:selectedProject.slug,details.fetched]);// Search projects
(0,react.useEffect)(()=>{if(debouncedSearchTerm!==undefined){onRefreshProjectList({title:debouncedSearchTerm});}else if(debouncedSearchTerm===''){onRefreshProjectList({});}},[debouncedSearchTerm]);// fetch the project conversations based on the selected project id from the url
(0,react.useEffect)(()=>{if(projectIdFromURL){const project=projectsList===null||projectsList===void 0?void 0:projectsList.find(project=>(project===null||project===void 0?void 0:project.id)===Number(projectIdFromURL));if(project){setSelectedProject(project);onGetProjectConversations({projectId:project===null||project===void 0?void 0:project.id},"reload");setDetails(prev=>(0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},prev),{},{fetched:false}));}}},[projectsList]);// Real time chat
(0,react.useEffect)(()=>{let socketConnection=(0,chat_gateway/* getWebSocket */.m)();socketConnection.on('chat',message=>{updateConversation(message,selectedProject);});return()=>{socketConnection.disconnect();(0,chat_gateway/* disConnectWebSocket */.i)();};},[selectedProject]);const handleInteraction=()=>{setHasUserInteracted(true);document.removeEventListener('click',handleInteraction);};(0,react.useEffect)(()=>{let shouldReload=false;const handleVisibilityChange=()=>{if(document.visibilityState==='visible'){const projectIdFromURL=Number(searchParams.get("projectId"));if(projectIdFromURL&&shouldReload){onGetProjectConversations({projectId:projectIdFromURL},"reload");shouldReload=false;}}else{setTimeout(()=>{shouldReload=true;},8000);}};document.addEventListener('visibilitychange',handleVisibilityChange);return()=>{document.removeEventListener('visibilitychange',handleVisibilityChange);};},[]);(0,react.useEffect)(()=>{document.addEventListener('click',handleInteraction);return()=>{document.removeEventListener('click',handleInteraction);};},[]);return/*#__PURE__*/(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[contextHolder,/*#__PURE__*/(0,jsx_runtime.jsxs)(Layout/* default */.A,{permissionSlug:permissionSlug,showSidebar:false,children:[/*#__PURE__*/(0,jsx_runtime.jsxs)(layout/* default */.A,{className:styles_module.layout,children:[/*#__PURE__*/(0,jsx_runtime.jsxs)(Sider,{className:styles_module.sider,width:window.innerWidth<768?window.innerWidth-10:350,breakpoint:"lg"//collapsedWidth='0' 
,theme:"light",zeroWidthTriggerStyle:{borderRadius:"100%",width:40,height:40,right:window.innerWidth<768&&collapsed?0:-20},trigger:collapsed?/*#__PURE__*/(0,jsx_runtime.jsx)(icons_RightCircleOutlined,{onClick:()=>setCollapsed(!collapsed),style:{fontSize:20,color:"var(--color-dark-sub)"}}):/*#__PURE__*/(0,jsx_runtime.jsx)(icons_LeftCircleOutlined,{onClick:()=>setCollapsed(!collapsed),style:{fontSize:20,color:"var(--color-dark-sub)"}}),collapsible:true,collapsed:collapsed,onCollapse:value=>setCollapsed(value),children:[/*#__PURE__*/(0,jsx_runtime.jsx)("div",{className:styles_module.sider_header,children:/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* CustomInput */.wi,{placeHolder:"Search...",value:searchTerm,onChange:e=>setSearchTerm(e.target.value),onClick:()=>setCollapsed(false)})}),!loadingProjectsList&&(projectsList===null||projectsList===void 0?void 0:projectsList.length)===0&&/*#__PURE__*/(0,jsx_runtime.jsx)("div",{className:styles_module.sider_empty,children:/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* CustomEmpty */.ZX,{description:"No projects found"})}),loadingProjectsList?/*#__PURE__*/(0,jsx_runtime.jsx)(skeleton/* default */.A,{avatar:true,paragraph:{rows:4},style:{padding:"0 1rem"}}):/*#__PURE__*/(0,jsx_runtime.jsx)(menu/* default */.A,{mode:"inline",defaultSelectedKeys:["project-".concat(projectIdFromURL)],items:projectsList===null||projectsList===void 0?void 0:projectsList.map((project,idx)=>{var _project$ProjectConve,_project$ProjectConve2,_project$ProjectConve3,_project$ProjectConve4,_project$ProjectConve5,_project$ProjectConve6,_project$ProjectConve7,_project$ProjectConve8,_project$ProjectConve9;const unreadConversationCount=project===null||project===void 0?void 0:project.unreadConversationCount;return{key:"project-".concat(project===null||project===void 0?void 0:project.id,"-").concat(idx,"-").concat(Math.random()*1000),label:/*#__PURE__*/(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* Typography */.o5,{className:styles_module.sider_item_title,color:collapsed?'light-100':'dark-main',size:"sm",style:{marginBottom:5},weight:unreadConversationCount>0?"bold":"normal",children:"".concat(project===null||project===void 0?void 0:project.referenceNumber," | ").concat(project===null||project===void 0?void 0:project.title)}),(project===null||project===void 0?void 0:(_project$ProjectConve=project.ProjectConversation)===null||_project$ProjectConve===void 0?void 0:_project$ProjectConve.message)&&/*#__PURE__*/(0,jsx_runtime.jsxs)("div",{className:"d-flex",children:[/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* Typography */.o5,{className:styles_module.sider_item_last_message,color:collapsed?'light-100':'dark-sub',size:"xs",weight:unreadConversationCount>0?"bold":"normal",children:project===null||project===void 0?void 0:(_project$ProjectConve2=project.ProjectConversation)===null||_project$ProjectConve2===void 0?void 0:_project$ProjectConve2.message}),/*#__PURE__*/(0,jsx_runtime.jsxs)("div",{className:"ml-auto mr-0 d-flex",children:[/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* Typography */.o5,{className:styles_module.sider_item_last_message,color:"dark-sub",size:"xs",weight:"normal",title:moment_default()(project===null||project===void 0?void 0:(_project$ProjectConve3=project.ProjectConversation)===null||_project$ProjectConve3===void 0?void 0:_project$ProjectConve3.addedDate).format("DD MMM, YYYY hh:mm A"),children:moment_default()(project===null||project===void 0?void 0:(_project$ProjectConve4=project.ProjectConversation)===null||_project$ProjectConve4===void 0?void 0:_project$ProjectConve4.addedDate).fromNow()}),unreadConversationCount>0&&/*#__PURE__*/(0,jsx_runtime.jsx)("div",{className:styles_module.badge,children:unreadConversationCount>9?"9+":unreadConversationCount})]})]}),(project===null||project===void 0?void 0:(_project$ProjectConve5=project.ProjectConversation)===null||_project$ProjectConve5===void 0?void 0:_project$ProjectConve5.mediaCount)>0&&/*#__PURE__*/(0,jsx_runtime.jsxs)("div",{className:"d-flex justify-space-between",children:[/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* Typography */.o5,{className:styles_module.sider_item_last_message,color:"dark-sub",size:"xs",weight:unreadConversationCount>0?"bold":"normal",children:"".concat(project===null||project===void 0?void 0:(_project$ProjectConve6=project.ProjectConversation)===null||_project$ProjectConve6===void 0?void 0:_project$ProjectConve6.mediaCount," file").concat((project===null||project===void 0?void 0:(_project$ProjectConve7=project.ProjectConversation)===null||_project$ProjectConve7===void 0?void 0:_project$ProjectConve7.mediaCount)>1?'s':'')}),/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* Typography */.o5,{className:styles_module.sider_item_last_message,color:"dark-sub",size:"xs",weight:"normal",title:moment_default()(project===null||project===void 0?void 0:(_project$ProjectConve8=project.ProjectConversation)===null||_project$ProjectConve8===void 0?void 0:_project$ProjectConve8.addedDate).format("DD MMM, YYYY hh:mm A"),children:moment_default()(project===null||project===void 0?void 0:(_project$ProjectConve9=project.ProjectConversation)===null||_project$ProjectConve9===void 0?void 0:_project$ProjectConve9.addedDate).fromNow()}),unreadConversationCount>0&&/*#__PURE__*/(0,jsx_runtime.jsx)("div",{className:styles_module.badge,children:unreadConversationCount>9?"9+":unreadConversationCount})]})]}),icon:/*#__PURE__*/(0,jsx_runtime.jsx)(Icons/* GroupIcon */.nF,{width:20,height:20}),onClick:()=>{if((selectedProject===null||selectedProject===void 0?void 0:selectedProject.id)===(project===null||project===void 0?void 0:project.id))return;setSearchParams({projectId:project.id.toString()},{replace:true});// set unread conversation count to 0 when the project is selected
setProjectsList(prev=>{const selectedProject=prev===null||prev===void 0?void 0:prev.find(item=>item.id===project.id);if(selectedProject){selectedProject.unreadConversationCount=0;}return[...prev];});setProjectConversations(prev=>(0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},prev),{},{data:[],showEndMessage:false,loading:{default:false,reload:true}}));// close the collapsed sidebar when a project is selected if it is open and the window width is less than 768px
if(window.innerWidth<768){setCollapsed(prev=>{if(prev===false)return true;return prev;});}},className:styles_module.myProjectList+" "+((selectedProject===null||selectedProject===void 0?void 0:selectedProject.id)===(project===null||project===void 0?void 0:project.id)?styles_module.activeProject:"")};})})]}),/*#__PURE__*/(0,jsx_runtime.jsxs)(layout/* default */.A,{children:[(selectedProject===null||selectedProject===void 0?void 0:selectedProject.id)&&/*#__PURE__*/(0,jsx_runtime.jsxs)(Header,{className:"".concat(styles_module.header," trigger cursor-pointer"),style:{position:'sticky',top:0,zIndex:1,width:'100%'},onClick:()=>setDetails(prev=>(0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},prev),{},{fetched:true,collapsed:!prev.collapsed})),children:[/*#__PURE__*/(0,jsx_runtime.jsx)(avatar/* default */.A,{icon:/*#__PURE__*/(0,jsx_runtime.jsx)(Icons/* GroupIcon */.nF,{})}),/*#__PURE__*/(0,jsx_runtime.jsxs)("div",{className:styles_module.header_content,children:[/*#__PURE__*/(0,jsx_runtime.jsx)(Title,{level:5,className:styles_module.header_content_title,ellipsis:{rows:1,expandable:false,tooltip:"".concat(selectedProject===null||selectedProject===void 0?void 0:selectedProject.referenceNumber," | ").concat(selectedProject===null||selectedProject===void 0?void 0:selectedProject.title)},children:"".concat(selectedProject===null||selectedProject===void 0?void 0:selectedProject.referenceNumber," | ").concat(selectedProject===null||selectedProject===void 0?void 0:selectedProject.title)}),(selectedProject===null||selectedProject===void 0?void 0:(_selectedProject$Proj3=selectedProject.ProjectMembers)===null||_selectedProject$Proj3===void 0?void 0:_selectedProject$Proj3.length)>0&&/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* Typography */.o5,{className:styles_module.header_content_members,color:"dark-sub",size:"xs",children:"".concat(firstThreeMembers===null||firstThreeMembers===void 0?void 0:firstThreeMembers.join(', ')," ").concat(otherMembersCount>0?"and ".concat(otherMembersCount," others"):'')})]}),/*#__PURE__*/(0,jsx_runtime.jsx)(tooltip/* default */.A,{title:"Refresh",placement:"left",children:/*#__PURE__*/(0,jsx_runtime.jsx)(Icons/* RefreshIcon */.fN,{onClick:event=>{event.stopPropagation();onGetProjectConversations({projectId:selectedProject===null||selectedProject===void 0?void 0:selectedProject.id},"reload");}})})]}),/*#__PURE__*/(0,jsx_runtime.jsxs)(Content,{ref:chatContainerRef,className:styles_module.content,style:{height:window.innerHeight-60,widows:'100%',position:'relative',flexDirection:(projectConversations===null||projectConversations===void 0?void 0:(_projectConversations5=projectConversations.data)===null||_projectConversations5===void 0?void 0:_projectConversations5.length)>0?'column-reverse':'column'},children:[!(selectedProject!==null&&selectedProject!==void 0&&selectedProject.id)&&/*#__PURE__*/(0,jsx_runtime.jsx)("div",{className:styles_module.content_empty_wrapper,children:/*#__PURE__*/(0,jsx_runtime.jsx)("div",{className:styles_module.content_empty,children:/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* CustomEmpty */.ZX,{description:"Select a project to see conversations",imageStyle:{height:200}})})}),(projectConversations===null||projectConversations===void 0?void 0:(_projectConversations6=projectConversations.loading)===null||_projectConversations6===void 0?void 0:_projectConversations6.default)&&(selectedProject===null||selectedProject===void 0?void 0:selectedProject.id)&&/*#__PURE__*/(0,jsx_runtime.jsx)(skeleton/* default */.A,{active:true}),(selectedProject===null||selectedProject===void 0?void 0:selectedProject.id)&&(projectConversations===null||projectConversations===void 0?void 0:(_projectConversations7=projectConversations.data)===null||_projectConversations7===void 0?void 0:_projectConversations7.length)===0&&/*#__PURE__*/(0,jsx_runtime.jsx)("div",{className:styles_module.content_empty_wrapper,children:/*#__PURE__*/(0,jsx_runtime.jsx)("div",{className:styles_module.content_empty,children:/*#__PURE__*/(0,jsx_runtime.jsx)(Atoms/* CustomEmpty */.ZX,{description:"No conversations yet"})})}),(projectConversations===null||projectConversations===void 0?void 0:(_projectConversations8=projectConversations.loading)===null||_projectConversations8===void 0?void 0:_projectConversations8.reload)&&/*#__PURE__*/(0,jsx_runtime.jsx)("div",{className:styles_module.content_loader,children:/*#__PURE__*/(0,jsx_runtime.jsx)(spin/* default */.A,{indicator:/*#__PURE__*/(0,jsx_runtime.jsx)(LoadingOutlined/* default */.A,{style:{fontSize:20},spin:true})})}),(projectConversations===null||projectConversations===void 0?void 0:(_projectConversations9=projectConversations.data)===null||_projectConversations9===void 0?void 0:_projectConversations9.length)>0&&/*#__PURE__*/(0,jsx_runtime.jsx)(index_es/* default */.A,{dataLength:projectConversations===null||projectConversations===void 0?void 0:(_projectConversations10=projectConversations.data)===null||_projectConversations10===void 0?void 0:_projectConversations10.length,hasMore:hasMore,inverse:true,height:window.innerHeight-180,style:{display:'flex',flexDirection:'column-reverse',overflowX:'hidden'},next:onGetNextConversations,loader:/*#__PURE__*/(0,jsx_runtime.jsx)("div",{className:styles_module.content_loader,children:/*#__PURE__*/(0,jsx_runtime.jsx)(spin/* default */.A,{indicator:/*#__PURE__*/(0,jsx_runtime.jsx)(LoadingOutlined/* default */.A,{style:{fontSize:20},spin:true})})}),endMessage:(projectConversations===null||projectConversations===void 0?void 0:projectConversations.showEndMessage)&&/*#__PURE__*/(0,jsx_runtime.jsx)("p",{className:"font-size-xs color-dark-sub",style:{textAlign:'center'},children:"End of conversations"}),children:(selectedProject===null||selectedProject===void 0?void 0:selectedProject.id)&&(projectConversations===null||projectConversations===void 0?void 0:(_projectConversations11=projectConversations.data)===null||_projectConversations11===void 0?void 0:_projectConversations11.map(conversation=>/*#__PURE__*/(0,jsx_runtime.jsx)(card,{data:conversation,setSelectedFile:setSelectedFile,onRemoveConversation:onRemoveConversation,projectMembers:selectedProject===null||selectedProject===void 0?void 0:selectedProject.ProjectMembers},conversation.id)))})]}),(selectedProject===null||selectedProject===void 0?void 0:selectedProject.id)&&/*#__PURE__*/(0,jsx_runtime.jsx)(Footer,{className:styles_module.conversations_footer,children:/*#__PURE__*/(0,jsx_runtime.jsx)("div",{className:styles_module.conversations_form,children:/*#__PURE__*/(0,jsx_runtime.jsx)("div",{className:styles_module.conversations_form_wrapper,children:/*#__PURE__*/(0,jsx_runtime.jsxs)("div",{className:styles_module.conversations_form_input_wrapper,children:[/*#__PURE__*/(0,jsx_runtime.jsx)("div",{style:{width:30},children:/*#__PURE__*/(0,jsx_runtime.jsx)(es_image/* default */.A,{preview:false,width:30,height:30,className:styles_module.conversations_form_avatar,src:"".concat(constants/* RESOURCE_BASE_URL */.to).concat(currentUser===null||currentUser===void 0?void 0:currentUser.profile),alt:"".concat(currentUser===null||currentUser===void 0?void 0:currentUser.firstName," ").concat(currentUser===null||currentUser===void 0?void 0:currentUser.lastName),style:{objectFit:"cover",borderRadius:"100%"}})}),/*#__PURE__*/(0,jsx_runtime.jsx)(upload/* default */.A,{fileList:fileList,customRequest:fileUpload,showUploadList:false,multiple:true,maxCount:10,onChange:_ref=>{let{fileList}=_ref;if(fileList.length>10){message/* default */.Ay.error('You can only upload 10 files at a time');return;}setFileList(fileList);},beforeUpload:(_file,fileList)=>{if(fileList.length<10){setFileList(fileList);return true;}else{message/* default */.Ay.error('You can only upload 10 files at a time');}return false;},children:/*#__PURE__*/(0,jsx_runtime.jsx)("div",{className:"px-1",children:/*#__PURE__*/(0,jsx_runtime.jsx)(es_button/* default */.A,{size:"small",type:"text",style:{backgroundColor:'transparent'},icon:/*#__PURE__*/(0,jsx_runtime.jsx)(PaperClipOutlined/* default */.A,{style:{fontSize:18}})})})}),/*#__PURE__*/(0,jsx_runtime.jsx)(mentions/* default */.A,{placeholder:"Type a message...  Tips: (Shift + Enter to send) (@ to mention)",className:"".concat(styles_module.conversations_form_input," w-100"),autoSize:{minRows:1,maxRows:4},onKeyDown:handleKeyDown,onKeyUp:handleKeyUp,options:projectMembersOptions,value:conversations.content,onChange:value=>{const replacedValue=value===null||value===void 0?void 0:value.replace(/\[(.*?)\]\(.*?\)/g,'$1');setConversations(prev=>(0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},prev),{},{content:replacedValue}));}}),conversations.loading?/*#__PURE__*/(0,jsx_runtime.jsx)(spin/* default */.A,{indicator:/*#__PURE__*/(0,jsx_runtime.jsx)(LoadingOutlined/* default */.A,{style:{fontSize:20},spin:true}),className:styles_module.conversations_form_send_loader}):/*#__PURE__*/(0,jsx_runtime.jsx)(Icons/* SendIcon */.qx,{className:styles_module.conversations_form_send,onClick:()=>{if(conversations.content.trim()==='')return;onAddConversation({message:conversations===null||conversations===void 0?void 0:conversations.content});}})]})})})})]}),details.collapsed&&/*#__PURE__*/(0,jsx_runtime.jsxs)(Sider,{className:styles_module.collapsed_sider,collapsible:true,collapsed:details.collapsed,onCollapse:value=>setDetails(prev=>(0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},prev),{},{collapsed:value})),collapsedWidth:430,trigger:null,style:{overflow:'auto',width:"100%"},children:[/*#__PURE__*/(0,jsx_runtime.jsxs)("div",{className:styles_module.collapsed_sider_header,children:[/*#__PURE__*/(0,jsx_runtime.jsx)(CloseOutlined/* default */.A,{style:{fontSize:18,color:"var(--color-dark-sub)",marginRight:10},onClick:()=>setDetails(prev=>(0,objectSpread2/* default */.A)((0,objectSpread2/* default */.A)({},prev),{},{collapsed:false}))}),/*#__PURE__*/(0,jsx_runtime.jsx)(Conversations_Text,{className:styles_module.collapsed_sider_header_title,ellipsis:{tooltip:"".concat(selectedProject===null||selectedProject===void 0?void 0:selectedProject.referenceNumber," | ").concat(selectedProject===null||selectedProject===void 0?void 0:selectedProject.title)},children:"".concat(selectedProject===null||selectedProject===void 0?void 0:selectedProject.referenceNumber," | ").concat(selectedProject===null||selectedProject===void 0?void 0:selectedProject.title)}),/*#__PURE__*/(0,jsx_runtime.jsx)("a",{className:"ml-1",target:"_blank",rel:"noreferrer",href:"/projects/".concat(selectedProject===null||selectedProject===void 0?void 0:selectedProject.slug,"?id=").concat(selectedProject===null||selectedProject===void 0?void 0:selectedProject.id),children:/*#__PURE__*/(0,jsx_runtime.jsx)(Icons/* ExternalIcon */.XM,{width:18,height:18,className:"ml-auto mt-2"})})]}),/*#__PURE__*/(0,jsx_runtime.jsx)(Details,{details:{data:selectedProjectDetails,files:{data:projectFiles||[],meta:projectFilesMeta,onRefresh:onRefreshProjectFiles},loading:selectedProjectDetailsLoading},setIsManageMediaOpen:setIsManageMediaOpen})]})]}),selectedFile.open&&/*#__PURE__*/(0,jsx_runtime.jsx)(drawer/* default */.A,{open:selectedFile.open,zIndex:9999,width:window.innerWidth>768?700:"100%",title:"Preview File",placement:"right",onClose:()=>setSelectedFile({path:'',open:false}),children:/*#__PURE__*/(0,jsx_runtime.jsx)(PreviewFile/* default */.A,{file:selectedFile.path})}),isManageMediaOpen&&/*#__PURE__*/(0,jsx_runtime.jsx)(manage_media/* default */.A,{projectId:selectedProject===null||selectedProject===void 0?void 0:selectedProject.id,isManageMediaOpen:isManageMediaOpen,setIsManageMediaOpen:setIsManageMediaOpen,media:{loading:loadingProjectFiles,data:projectFiles||[],onRefresh:onRefreshProjectFiles,meta:projectFilesMeta}})]})]});};/* harmony default export */ const Conversations = (AllConversations);

/***/ })

}]);